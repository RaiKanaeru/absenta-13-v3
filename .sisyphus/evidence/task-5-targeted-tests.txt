
> absenta-13@1.0.0 test:server
> node --test server/**/__tests__/**/*.test.js

TAP version 13
# [32m2026-02-19 05:48:58.091 | INFO  | DB  | Database pool registered in centralized config[0m
# Subtest: Attendance Calculator
    # Subtest: getEffectiveDaysMapFromDB
    not ok 1 - getEffectiveDaysMapFromDB
      ---
      duration_ms: 0.4675
      type: 'suite'
      location: 'D:\\CODING\\absenta-13-v3\\server\\__tests__\\attendanceCalculator.test.js:42:5'
      failureType: 'testCodeFailure'
      error: 'beforeEach is not defined'
      code: 'ERR_TEST_FAILURE'
      name: 'ReferenceError'
      stack: |-
        SuiteContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/attendanceCalculator.test.js:43:9)
        Suite.runInAsyncScope (node:async_hooks:214:14)
        Suite.createBuild (node:internal/test_runner/test:1402:13)
        new Suite (node:internal/test_runner/test:1393:28)
        Suite.createSubtest (node:internal/test_runner/test:808:18)
        run (node:internal/test_runner/harness:302:28)
        test (node:internal/test_runner/harness:316:12)
        SuiteContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/attendanceCalculator.test.js:42:5)
        Suite.runInAsyncScope (node:async_hooks:214:14)
        Suite.createBuild (node:internal/test_runner/test:1402:13)
      ...
    # Subtest: calculateEffectiveDaysForRange
    not ok 2 - calculateEffectiveDaysForRange
      ---
      duration_ms: 0.1314
      type: 'suite'
      location: 'D:\\CODING\\absenta-13-v3\\server\\__tests__\\attendanceCalculator.test.js:70:5'
      failureType: 'testCodeFailure'
      error: 'beforeEach is not defined'
      code: 'ERR_TEST_FAILURE'
      name: 'ReferenceError'
      stack: |-
        SuiteContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/attendanceCalculator.test.js:71:9)
        Suite.runInAsyncScope (node:async_hooks:214:14)
        Suite.createBuild (node:internal/test_runner/test:1402:13)
        new Suite (node:internal/test_runner/test:1393:28)
        Suite.createSubtest (node:internal/test_runner/test:808:18)
        run (node:internal/test_runner/harness:302:28)
        test (node:internal/test_runner/harness:316:12)
        SuiteContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/attendanceCalculator.test.js:70:5)
        Suite.runInAsyncScope (node:async_hooks:214:14)
        Suite.createBuild (node:internal/test_runner/test:1402:13)
      ...
    # Subtest: calculateAttendancePercentage
        # Subtest: should calculate basic percentage
        ok 1 - should calculate basic percentage
          ---
          duration_ms: 0.7918
          type: 'test'
          ...
        # Subtest: should cap at 100% and flag capped
        ok 2 - should cap at 100% and flag capped
          ---
          duration_ms: 0.5277
          type: 'test'
          ...
        # Subtest: should handle zero effective days
        ok 3 - should handle zero effective days
          ---
          duration_ms: 0.3138
          type: 'test'
          ...
        1..3
    ok 3 - calculateAttendancePercentage
      ---
      duration_ms: 2.4218
      type: 'suite'
      ...
    1..3
not ok 1 - Attendance Calculator
  ---
  duration_ms: 4.6922
  type: 'suite'
  location: 'D:\\CODING\\absenta-13-v3\\server\\__tests__\\attendanceCalculator.test.js:40:1'
  failureType: 'subtestsFailed'
  error: '2 subtests failed'
  code: 'ERR_TEST_FAILURE'
  ...
# [33m2026-02-19 05:48:58.106 | WARN  | AttendanceCalculator  | Attendance percentage exceeds 100% - possible data inconsistency {"hadirCount":22,"totalEffectiveDays":20,"rawPercentage":"110.00","context":""}[0m
# [33m2026-02-19 05:48:58.107 | WARN  | AttendanceCalculator  | Total effective days is zero or negative {"totalEffectiveDays":0,"context":""}[0m
# Run tests with: node --test server/__tests__/auth.test.js
# Subtest: Rate Limiting
    # Subtest: should allow first login attempt
    ok 1 - should allow first login attempt
      ---
      duration_ms: 2.6726
      type: 'test'
      ...
    # Subtest: should track failed attempts
    ok 2 - should track failed attempts
      ---
      duration_ms: 0.6551
      type: 'test'
      ...
    # Subtest: should lock after max attempts
    ok 3 - should lock after max attempts
      ---
      duration_ms: 0.7481
      type: 'test'
      ...
    # Subtest: should reset attempts on success
    ok 4 - should reset attempts on success
      ---
      duration_ms: 0.6727
      type: 'test'
      ...
    1..4
ok 2 - Rate Limiting
  ---
  duration_ms: 6.5251
  type: 'suite'
  ...
# Subtest: Time Validation
    # Subtest: should validate correct time formats
    ok 1 - should validate correct time formats
      ---
      duration_ms: 0.3652
      type: 'test'
      ...
    # Subtest: should reject invalid time formats
    ok 2 - should reject invalid time formats
      ---
      duration_ms: 0.1681
      type: 'test'
      ...
    1..2
ok 3 - Time Validation
  ---
  duration_ms: 0.7348
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: Login Attempts - Lockout Logic
    # Subtest: should allow first attempt
    ok 1 - should allow first attempt
      ---
      duration_ms: 1.2023
      type: 'test'
      ...
    # Subtest: should track remaining attempts
    ok 2 - should track remaining attempts
      ---
      duration_ms: 0.2216
      type: 'test'
      ...
    # Subtest: should lock after max attempts
    ok 3 - should lock after max attempts
      ---
      duration_ms: 0.3382
      type: 'test'
      ...
    # Subtest: should unlock after lockout expires
    ok 4 - should unlock after lockout expires
      ---
      duration_ms: 0.2241
      type: 'test'
      ...
    1..4
ok 4 - Login Attempts - Lockout Logic
  ---
  duration_ms: 3.5256
  type: 'suite'
  ...
# Subtest: Record Failed Attempt
    # Subtest: should create new attempt record
    ok 1 - should create new attempt record
      ---
      duration_ms: 0.4086
      type: 'test'
      ...
    # Subtest: should increment count
    ok 2 - should increment count
      ---
      duration_ms: 0.1801
      type: 'test'
      ...
    # Subtest: should set lockout at max attempts
    ok 3 - should set lockout at max attempts
      ---
      duration_ms: 0.3546
      type: 'test'
      ...
    1..3
ok 5 - Record Failed Attempt
  ---
  duration_ms: 1.6186
  type: 'suite'
  ...
# Subtest: Login Input Validation
    # Subtest: should accept valid credentials
    ok 1 - should accept valid credentials
      ---
      duration_ms: 0.5528
      type: 'test'
      ...
    # Subtest: should reject empty username
    ok 2 - should reject empty username
      ---
      duration_ms: 0.3324
      type: 'test'
      ...
    # Subtest: should reject empty password
    ok 3 - should reject empty password
      ---
      duration_ms: 0.3619
      type: 'test'
      ...
    # Subtest: should reject both empty
    ok 4 - should reject both empty
      ---
      duration_ms: 0.1743
      type: 'test'
      ...
    1..4
ok 6 - Login Input Validation
  ---
  duration_ms: 1.9329
  type: 'suite'
  ...
# Subtest: JWT Token Format Validation
    # Subtest: should accept valid JWT format
    ok 1 - should accept valid JWT format
      ---
      duration_ms: 0.2335
      type: 'test'
      ...
    # Subtest: should reject token with wrong parts
    ok 2 - should reject token with wrong parts
      ---
      duration_ms: 0.1458
      type: 'test'
      ...
    # Subtest: should reject empty token
    ok 3 - should reject empty token
      ---
      duration_ms: 0.17
      type: 'test'
      ...
    # Subtest: should reject null token
    ok 4 - should reject null token
      ---
      duration_ms: 0.1114
      type: 'test'
      ...
    1..4
ok 7 - JWT Token Format Validation
  ---
  duration_ms: 0.9907
  type: 'suite'
  ...
# Subtest: Download Access Utilities
    # Subtest: should build filename with user id
    ok 1 - should build filename with user id
      ---
      duration_ms: 1.4012
      type: 'test'
      ...
    # Subtest: should extract user id from filename
    ok 2 - should extract user id from filename
      ---
      duration_ms: 1.4411
      type: 'test'
      ...
    # Subtest: should verify ownership by user id
    ok 3 - should verify ownership by user id
      ---
      duration_ms: 0.4359
      type: 'test'
      ...
    # Subtest: should reject unsafe filenames
    ok 4 - should reject unsafe filenames
      ---
      duration_ms: 0.448
      type: 'test'
      ...
    # Subtest: should allow xlsx extension only
    ok 5 - should allow xlsx extension only
      ---
      duration_ms: 0.1919
      type: 'test'
      ...
    1..5
ok 8 - Download Access Utilities
  ---
  duration_ms: 5.7239
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: formatBytes
    # Subtest: should return "0 Bytes" for 0
    ok 1 - should return "0 Bytes" for 0
      ---
      duration_ms: 2.6467
      type: 'test'
      ...
    # Subtest: should format bytes correctly
    ok 2 - should format bytes correctly
      ---
      duration_ms: 0.246
      type: 'test'
      ...
    # Subtest: should format KB correctly
    ok 3 - should format KB correctly
      ---
      duration_ms: 0.2936
      type: 'test'
      ...
    # Subtest: should format MB correctly
    ok 4 - should format MB correctly
      ---
      duration_ms: 0.1882
      type: 'test'
      ...
    # Subtest: should format with custom decimals
    ok 5 - should format with custom decimals
      ---
      duration_ms: 0.2365
      type: 'test'
      ...
    # Subtest: should handle large values (GB)
    ok 6 - should handle large values (GB)
      ---
      duration_ms: 0.1959
      type: 'test'
      ...
    1..6
ok 9 - formatBytes
  ---
  duration_ms: 5.6157
  type: 'suite'
  ...
# Subtest: formatNumber
    # Subtest: should format small numbers
    ok 1 - should format small numbers
      ---
      duration_ms: 29.1642
      type: 'test'
      ...
    # Subtest: should add thousand separators
    ok 2 - should add thousand separators
      ---
      duration_ms: 0.4923
      type: 'test'
      ...
    1..2
ok 10 - formatNumber
  ---
  duration_ms: 30.0051
  type: 'suite'
  ...
# Subtest: formatPercentage
    # Subtest: should format whole percentage
    ok 1 - should format whole percentage
      ---
      duration_ms: 0.4008
      type: 'test'
      ...
    # Subtest: should format decimal percentage
    ok 2 - should format decimal percentage
      ---
      duration_ms: 0.3469
      type: 'test'
      ...
    # Subtest: should respect custom decimals
    ok 3 - should respect custom decimals
      ---
      duration_ms: 0.1722
      type: 'test'
      ...
    # Subtest: should format zero
    ok 4 - should format zero
      ---
      duration_ms: 0.1191
      type: 'test'
      ...
    1..4
ok 11 - formatPercentage
  ---
  duration_ms: 1.3748
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: NIP Validation
    # Subtest: should accept valid 18-digit NIP
    ok 1 - should accept valid 18-digit NIP
      ---
      duration_ms: 1.3931
      type: 'test'
      ...
    # Subtest: should accept valid 10-digit NIP
    ok 2 - should accept valid 10-digit NIP
      ---
      duration_ms: 0.306
      type: 'test'
      ...
    # Subtest: should reject NIP with less than 10 digits
    ok 3 - should reject NIP with less than 10 digits
      ---
      duration_ms: 0.1916
      type: 'test'
      ...
    # Subtest: should reject NIP with more than 20 digits
    ok 4 - should reject NIP with more than 20 digits
      ---
      duration_ms: 0.173
      type: 'test'
      ...
    # Subtest: should reject NIP with non-numeric characters
    ok 5 - should reject NIP with non-numeric characters
      ---
      duration_ms: 0.1582
      type: 'test'
      ...
    # Subtest: should reject empty NIP
    ok 6 - should reject empty NIP
      ---
      duration_ms: 0.1414
      type: 'test'
      ...
    1..6
ok 12 - NIP Validation
  ---
  duration_ms: 4.1775
  type: 'suite'
  ...
# Subtest: Guru Nama Validation
    # Subtest: should accept valid name
    ok 1 - should accept valid name
      ---
      duration_ms: 0.4479
      type: 'test'
      ...
    # Subtest: should accept 2-char name
    ok 2 - should accept 2-char name
      ---
      duration_ms: 0.3641
      type: 'test'
      ...
    # Subtest: should reject 1-char name
    ok 3 - should reject 1-char name
      ---
      duration_ms: 0.3728
      type: 'test'
      ...
    # Subtest: should reject empty name
    ok 4 - should reject empty name
      ---
      duration_ms: 0.3658
      type: 'test'
      ...
    # Subtest: should reject whitespace-only name
    ok 5 - should reject whitespace-only name
      ---
      duration_ms: 0.1599
      type: 'test'
      ...
    1..5
ok 13 - Guru Nama Validation
  ---
  duration_ms: 2.1442
  type: 'suite'
  ...
# Subtest: Guru Username Validation
    # Subtest: should accept valid lowercase username
    ok 1 - should accept valid lowercase username
      ---
      duration_ms: 0.3076
      type: 'test'
      ...
    # Subtest: should accept username with numbers
    ok 2 - should accept username with numbers
      ---
      duration_ms: 0.1482
      type: 'test'
      ...
    # Subtest: should reject username shorter than 4 chars
    ok 3 - should reject username shorter than 4 chars
      ---
      duration_ms: 1.112
      type: 'test'
      ...
    # Subtest: should reject username with uppercase
    ok 4 - should reject username with uppercase
      ---
      duration_ms: 0.1689
      type: 'test'
      ...
    # Subtest: should reject username with spaces
    ok 5 - should reject username with spaces
      ---
      duration_ms: 0.1263
      type: 'test'
      ...
    1..5
ok 14 - Guru Username Validation
  ---
  duration_ms: 2.0885
  type: 'suite'
  ...
# Subtest: Guru Status Validation
    # Subtest: should accept aktif
    ok 1 - should accept aktif
      ---
      duration_ms: 0.2395
      type: 'test'
      ...
    # Subtest: should accept nonaktif
    ok 2 - should accept nonaktif
      ---
      duration_ms: 0.116
      type: 'test'
      ...
    # Subtest: should accept empty (optional)
    ok 3 - should accept empty (optional)
      ---
      duration_ms: 0.1054
      type: 'test'
      ...
    # Subtest: should reject invalid status
    ok 4 - should reject invalid status
      ---
      duration_ms: 0.1002
      type: 'test'
      ...
    1..4
ok 15 - Guru Status Validation
  ---
  duration_ms: 0.7289
  type: 'suite'
  ...
# Subtest: Teacher Attendance Status
    # Subtest: should accept Hadir
    ok 1 - should accept Hadir
      ---
      duration_ms: 0.2313
      type: 'test'
      ...
    # Subtest: should accept Tidak Hadir
    ok 2 - should accept Tidak Hadir
      ---
      duration_ms: 0.1129
      type: 'test'
      ...
    # Subtest: should accept Izin
    ok 3 - should accept Izin
      ---
      duration_ms: 0.1058
      type: 'test'
      ...
    # Subtest: should accept Sakit
    ok 4 - should accept Sakit
      ---
      duration_ms: 0.0966
      type: 'test'
      ...
    # Subtest: should reject invalid status
    ok 5 - should reject invalid status
      ---
      duration_ms: 0.1041
      type: 'test'
      ...
    1..5
ok 16 - Teacher Attendance Status
  ---
  duration_ms: 0.9577
  type: 'suite'
  ...
# [32m2026-02-19 05:48:58.214 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.217 | INFO  | Jadwal [req_mlt1jap4_72edfacf] | CreateJadwal started {"kelas_id":1,"mapel_id":1,"hari":"Senin","jam_ke":1}[0m
# [33m2026-02-19 05:48:58.217 | WARN  | Jadwal [req_mlt1jap4_72edfacf] | Validation failed {"field":"time","value":{"jam_mulai":"25:00","jam_selesai":"08:00"},"reason":"Format waktu tidak valid. Gunakan format 24 jam (HH:MM)"}[0m
# [req_1771480138218_831aca08] Error: {
#   message: 'Format waktu tidak valid. Gunakan format 24 jam (HH:MM)',
#   code: 2001,
#   stack: 'AppError: Format waktu tidak valid. Gunakan format 24 jam (HH:MM)\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at Module.createJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1719:20)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:50:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async startSubtestAfterBootstrap (node:internal/test_runner/harness:296:3)'
# }
# [32m2026-02-19 05:48:58.221 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.222 | INFO  | Jadwal [req_mlt1japa_2facee31] | CreateJadwal started {"kelas_id":1,"mapel_id":1,"hari":"Senin","jam_ke":1}[0m
# [33m2026-02-19 05:48:58.222 | WARN  | Jadwal [req_mlt1japa_2facee31] | Validation failed {"field":"time","value":{"jam_mulai":"08:00","jam_selesai":"07:00"},"reason":"Jam selesai harus setelah jam mulai"}[0m
# [req_1771480138223_76b9c266] Error: {
#   message: 'Jam selesai harus setelah jam mulai',
#   code: 2001,
#   stack: 'AppError: Jam selesai harus setelah jam mulai\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at Module.createJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1719:20)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:63:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:48:58.224 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.225 | INFO  | Jadwal [req_mlt1japd_2c736549] | GetJadwal started {}[0m
# [32m2026-02-19 05:48:58.226 | INFO  | Jadwal [req_mlt1japd_2c736549] | GetJadwal completed {"count":1}[0m
# [32m2026-02-19 05:48:58.226 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.227 | INFO  | Jadwal [req_mlt1jape_ee51680f] | GetJadwal started {}[0m
# [31m2026-02-19 05:48:58.227 | ERROR | Jadwal [req_mlt1jape_ee51680f] | Database getJadwal failed {} | Error: DB Error[0m
# [req_1771480138227_b995836d] Error: {
#   message: 'DB Error',
#   code: undefined,
#   stack: 'Error: DB Error\\n' +
#     '    at Object.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:82:73)\\n' +
#     '    at Object.apply (node:internal/test_runner/mock/mock:765:20)\\n' +
#     '    at Object.execute (file:///D:/CODING/absenta-13-v3/server/config/db.js:31:21)\\n' +
#     '    at Module.getJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1688:33)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:84:36)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:48:58.228 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.230 | INFO  | Jadwal [req_mlt1japi_6f2d2b13] | CreateJadwal started {"kelas_id":1,"mapel_id":1,"hari":"Senin","jam_ke":1}[0m
# [32m2026-02-19 05:48:58.233 | INFO  | Jadwal [req_mlt1japi_6f2d2b13] | CreateJadwal completed {"jadwalId":10,"hari":"Senin","jam_ke":1,"guruCount":1}[0m
# [32m2026-02-19 05:48:58.234 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.235 | INFO  | Jadwal [req_mlt1japn_8a4d19a5] | CreateJadwal started {}[0m
# [33m2026-02-19 05:48:58.235 | WARN  | Jadwal [req_mlt1japn_8a4d19a5] | Validation failed {"field":"jadwal","value":{"jam_mulai":"07:00","jam_selesai":"08:00","jenis_aktivitas":"pelajaran"},"reason":"Missing required fields"}[0m
# [req_1771480138235_7a2b2c53] Error: {
#   message: 'Semua field wajib diisi',
#   code: 2001,
#   stack: 'AppError: Semua field wajib diisi\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at Module.createJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1719:20)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:128:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:48:58.236 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.237 | INFO  | Jadwal [req_mlt1japp_f99a434d] | DeleteJadwal started {"id":1}[0m
# [32m2026-02-19 05:48:58.237 | INFO  | Jadwal [req_mlt1japp_f99a434d] | DeleteJadwal completed {"id":1}[0m
# [32m2026-02-19 05:48:58.237 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.238 | INFO  | Jadwal [req_mlt1japq_c2d9a3bd] | DeleteJadwal started {"id":999}[0m
# [33m2026-02-19 05:48:58.238 | WARN  | Jadwal [req_mlt1japq_c2d9a3bd] | DeleteJadwal - not found {"id":999}[0m
# [req_1771480138238_be987e6f] Error: {
#   message: 'Jadwal tidak ditemukan',
#   code: 1005,
#   stack: 'AppError: Jadwal tidak ditemukan\\n' +
#     '    at sendNotFoundError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:236:19)\\n' +
#     '    at Module.deleteJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1851:20)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:150:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# Subtest: Jadwal Controller
    # Subtest: Helper Logic Validation (via createJadwal)
        # Subtest: should reject invalid time format
        ok 1 - should reject invalid time format
          ---
          duration_ms: 6.9582
          type: 'test'
          ...
        # Subtest: should reject if end time is before start time
        ok 2 - should reject if end time is before start time
          ---
          duration_ms: 2.1123
          type: 'test'
          ...
        1..2
    ok 1 - Helper Logic Validation (via createJadwal)
      ---
      duration_ms: 10.4367
      type: 'suite'
      ...
    # Subtest: getJadwal
        # Subtest: should return all schedules
        ok 1 - should return all schedules
          ---
          duration_ms: 2.2094
          type: 'test'
          ...
        # Subtest: should handle database errors
        ok 2 - should handle database errors
          ---
          duration_ms: 1.9188
          type: 'test'
          ...
        1..2
    ok 2 - getJadwal
      ---
      duration_ms: 4.4733
      type: 'suite'
      ...
    # Subtest: createJadwal
        # Subtest: should create valid schedule
        ok 1 - should create valid schedule
          ---
          duration_ms: 5.8754
          type: 'test'
          ...
        # Subtest: should fail if missing required fields
        ok 2 - should fail if missing required fields
          ---
          duration_ms: 1.2341
          type: 'test'
          ...
        1..2
    ok 3 - createJadwal
      ---
      duration_ms: 7.7024
      type: 'suite'
      ...
    # Subtest: deleteJadwal
        # Subtest: should delete existing schedule
        ok 1 - should delete existing schedule
          ---
          duration_ms: 1.1229
          type: 'test'
          ...
        # Subtest: should return 404 if not found
        ok 2 - should return 404 if not found
          ---
          duration_ms: 1.3414
          type: 'test'
          ...
        1..2
    ok 4 - deleteJadwal
      ---
      duration_ms: 2.7818
      type: 'suite'
      ...
    1..4
ok 17 - Jadwal Controller
  ---
  duration_ms: 26.7253
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: Time Format Validation
    # Subtest: should accept HH:MM format
    ok 1 - should accept HH:MM format
      ---
      duration_ms: 1.3117
      type: 'test'
      ...
    # Subtest: should accept H:MM format
    ok 2 - should accept H:MM format
      ---
      duration_ms: 0.2201
      type: 'test'
      ...
    # Subtest: should accept HH:MM:SS format
    ok 3 - should accept HH:MM:SS format
      ---
      duration_ms: 0.1531
      type: 'test'
      ...
    # Subtest: should reject invalid hours
    ok 4 - should reject invalid hours
      ---
      duration_ms: 0.2771
      type: 'test'
      ...
    # Subtest: should reject invalid minutes
    ok 5 - should reject invalid minutes
      ---
      duration_ms: 0.1512
      type: 'test'
      ...
    # Subtest: should reject invalid format
    ok 6 - should reject invalid format
      ---
      duration_ms: 0.1386
      type: 'test'
      ...
    1..6
ok 18 - Time Format Validation
  ---
  duration_ms: 3.9237
  type: 'suite'
  ...
# Subtest: Time Range Validation
    # Subtest: should accept valid range (mulai < selesai)
    ok 1 - should accept valid range (mulai < selesai)
      ---
      duration_ms: 0.4249
      type: 'test'
      ...
    # Subtest: should reject invalid range (mulai >= selesai)
    ok 2 - should reject invalid range (mulai >= selesai)
      ---
      duration_ms: 0.3818
      type: 'test'
      ...
    # Subtest: should handle edge cases
    ok 3 - should handle edge cases
      ---
      duration_ms: 0.3324
      type: 'test'
      ...
    # Subtest: should reject null/empty values
    ok 4 - should reject null/empty values
      ---
      duration_ms: 0.3968
      type: 'test'
      ...
    1..4
ok 19 - Time Range Validation
  ---
  duration_ms: 1.9532
  type: 'suite'
  ...
# Subtest: Jam Ke Range Validation
    # Subtest: should accept valid jam_ke (1-15)
    ok 1 - should accept valid jam_ke (1-15)
      ---
      duration_ms: 0.2979
      type: 'test'
      ...
    # Subtest: should reject jam_ke below minimum
    ok 2 - should reject jam_ke below minimum
      ---
      duration_ms: 0.1187
      type: 'test'
      ...
    # Subtest: should reject jam_ke above maximum
    ok 3 - should reject jam_ke above maximum
      ---
      duration_ms: 0.1021
      type: 'test'
      ...
    # Subtest: should reject null/undefined
    ok 4 - should reject null/undefined
      ---
      duration_ms: 0.1145
      type: 'test'
      ...
    # Subtest: should accept string numbers
    ok 5 - should accept string numbers
      ---
      duration_ms: 0.1036
      type: 'test'
      ...
    1..5
ok 20 - Jam Ke Range Validation
  ---
  duration_ms: 0.9466
  type: 'suite'
  ...
# Subtest: Duplicate Jam Ke Detection
    # Subtest: should detect no duplicates
    ok 1 - should detect no duplicates
      ---
      duration_ms: 1.7298
      type: 'test'
      ...
    # Subtest: should detect duplicates
    ok 2 - should detect duplicates
      ---
      duration_ms: 0.1664
      type: 'test'
      ...
    # Subtest: should handle empty array
    ok 3 - should handle empty array
      ---
      duration_ms: 0.1158
      type: 'test'
      ...
    1..3
ok 21 - Duplicate Jam Ke Detection
  ---
  duration_ms: 2.1634
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: Kelas - Tingkat Extraction
    # Subtest: should extract X from "X IPA 1"
    ok 1 - should extract X from "X IPA 1"
      ---
      duration_ms: 2.3407
      type: 'test'
      ...
    # Subtest: should extract XI from "XI RPL 2"
    ok 2 - should extract XI from "XI RPL 2"
      ---
      duration_ms: 0.2542
      type: 'test'
      ...
    # Subtest: should extract XII from "XII TKJ 3"
    ok 3 - should extract XII from "XII TKJ 3"
      ---
      duration_ms: 0.2044
      type: 'test'
      ...
    # Subtest: should return null for empty string
    ok 4 - should return null for empty string
      ---
      duration_ms: 0.3047
      type: 'test'
      ...
    # Subtest: should return null for null input
    ok 5 - should return null for null input
      ---
      duration_ms: 0.2134
      type: 'test'
      ...
    1..5
ok 22 - Kelas - Tingkat Extraction
  ---
  duration_ms: 5.0512
  type: 'suite'
  ...
# Subtest: Kelas - Safe Delete Check
    # Subtest: should allow delete when no dependencies
    ok 1 - should allow delete when no dependencies
      ---
      duration_ms: 0.3555
      type: 'test'
      ...
    # Subtest: should block delete when has students
    ok 2 - should block delete when has students
      ---
      duration_ms: 0.4785
      type: 'test'
      ...
    # Subtest: should block delete when has jadwal
    ok 3 - should block delete when has jadwal
      ---
      duration_ms: 0.4605
      type: 'test'
      ...
    # Subtest: should report both reasons when has both
    ok 4 - should report both reasons when has both
      ---
      duration_ms: 0.6011
      type: 'test'
      ...
    1..4
ok 23 - Kelas - Safe Delete Check
  ---
  duration_ms: 2.8103
  type: 'suite'
  ...
# Subtest: Ruang - Kode Validation
    # Subtest: should validate and uppercase valid code
    ok 1 - should validate and uppercase valid code
      ---
      duration_ms: 0.4054
      type: 'test'
      ...
    # Subtest: should reject empty code
    ok 2 - should reject empty code
      ---
      duration_ms: 0.1433
      type: 'test'
      ...
    # Subtest: should reject code longer than 10 chars
    ok 3 - should reject code longer than 10 chars
      ---
      duration_ms: 0.1307
      type: 'test'
      ...
    # Subtest: should accept exactly 10 chars
    ok 4 - should accept exactly 10 chars
      ---
      duration_ms: 0.131
      type: 'test'
      ...
    1..4
ok 24 - Ruang - Kode Validation
  ---
  duration_ms: 1.0497
  type: 'suite'
  ...
# [dotenv@17.2.3] injecting env (25) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
# Subtest: DownloadQueue file access
    # Subtest: purges expired file access entries
    ok 1 - purges expired file access entries
      ---
      duration_ms: 0.7745
      type: 'test'
      ...
    # Subtest: falls back to filename ownership when map entry expired
    ok 2 - falls back to filename ownership when map entry expired
      ---
      duration_ms: 0.3069
      type: 'test'
      ...
    # Subtest: removes filepath from job status result
    ok 3 - removes filepath from job status result
      ---
      duration_ms: 0.4493
      type: 'test'
      ...
    1..3
ok 25 - DownloadQueue file access
  ---
  duration_ms: 2.3838
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: NIS Validation
    # Subtest: should accept valid 10-digit NIS
    ok 1 - should accept valid 10-digit NIS
      ---
      duration_ms: 1.4143
      type: 'test'
      ...
    # Subtest: should accept valid 8-digit NIS
    ok 2 - should accept valid 8-digit NIS
      ---
      duration_ms: 0.3453
      type: 'test'
      ...
    # Subtest: should accept valid 15-digit NIS
    ok 3 - should accept valid 15-digit NIS
      ---
      duration_ms: 0.1914
      type: 'test'
      ...
    # Subtest: should reject NIS with less than 8 digits
    ok 4 - should reject NIS with less than 8 digits
      ---
      duration_ms: 0.3148
      type: 'test'
      ...
    # Subtest: should reject NIS with more than 15 digits
    ok 5 - should reject NIS with more than 15 digits
      ---
      duration_ms: 0.3109
      type: 'test'
      ...
    # Subtest: should reject NIS with non-numeric characters
    ok 6 - should reject NIS with non-numeric characters
      ---
      duration_ms: 0.1876
      type: 'test'
      ...
    # Subtest: should reject empty NIS
    ok 7 - should reject empty NIS
      ---
      duration_ms: 0.5016
      type: 'test'
      ...
    1..7
ok 26 - NIS Validation
  ---
  duration_ms: 5.5059
  type: 'suite'
  ...
# Subtest: Username Validation
    # Subtest: should accept valid lowercase username
    ok 1 - should accept valid lowercase username
      ---
      duration_ms: 0.5206
      type: 'test'
      ...
    # Subtest: should accept username with underscore
    ok 2 - should accept username with underscore
      ---
      duration_ms: 0.4964
      type: 'test'
      ...
    # Subtest: should reject username shorter than 4 chars
    ok 3 - should reject username shorter than 4 chars
      ---
      duration_ms: 0.424
      type: 'test'
      ...
    # Subtest: should reject username with uppercase
    ok 4 - should reject username with uppercase
      ---
      duration_ms: 0.2002
      type: 'test'
      ...
    # Subtest: should reject username with spaces
    ok 5 - should reject username with spaces
      ---
      duration_ms: 0.1428
      type: 'test'
      ...
    1..5
ok 27 - Username Validation
  ---
  duration_ms: 2.4588
  type: 'suite'
  ...
# Subtest: Email Validation
    # Subtest: should accept valid email
    ok 1 - should accept valid email
      ---
      duration_ms: 0.3268
      type: 'test'
      ...
    # Subtest: should accept empty email (optional)
    ok 2 - should accept empty email (optional)
      ---
      duration_ms: 0.126
      type: 'test'
      ...
    # Subtest: should reject invalid email format
    ok 3 - should reject invalid email format
      ---
      duration_ms: 1.79
      type: 'test'
      ...
    1..3
ok 28 - Email Validation
  ---
  duration_ms: 2.4511
  type: 'suite'
  ...
# Subtest: Password Validation
    # Subtest: should accept password with 6+ chars on create
    ok 1 - should accept password with 6+ chars on create
      ---
      duration_ms: 0.2759
      type: 'test'
      ...
    # Subtest: should reject short password on create
    ok 2 - should reject short password on create
      ---
      duration_ms: 0.1258
      type: 'test'
      ...
    # Subtest: should allow empty password on update
    ok 3 - should allow empty password on update
      ---
      duration_ms: 0.1045
      type: 'test'
      ...
    # Subtest: should reject short password on update if provided
    ok 4 - should reject short password on update if provided
      ---
      duration_ms: 0.1019
      type: 'test'
      ...
    1..4
ok 29 - Password Validation
  ---
  duration_ms: 0.7893
  type: 'suite'
  ...
# Subtest: Jenis Kelamin Validation
    # Subtest: should accept L
    ok 1 - should accept L
      ---
      duration_ms: 0.2473
      type: 'test'
      ...
    # Subtest: should accept P
    ok 2 - should accept P
      ---
      duration_ms: 0.1317
      type: 'test'
      ...
    # Subtest: should accept empty (optional)
    ok 3 - should accept empty (optional)
      ---
      duration_ms: 0.1261
      type: 'test'
      ...
    # Subtest: should reject invalid value
    ok 4 - should reject invalid value
      ---
      duration_ms: 0.1259
      type: 'test'
      ...
    1..4
ok 30 - Jenis Kelamin Validation
  ---
  duration_ms: 0.9322
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: Student Data Validation
    # Subtest: should pass with valid data
    ok 1 - should pass with valid data
      ---
      duration_ms: 2.119
      type: 'test'
      ...
    # Subtest: should fail with missing NIS
    ok 2 - should fail with missing NIS
      ---
      duration_ms: 0.4231
      type: 'test'
      ...
    # Subtest: should fail with invalid jenis_kelamin
    ok 3 - should fail with invalid jenis_kelamin
      ---
      duration_ms: 0.2528
      type: 'test'
      ...
    1..3
ok 31 - Student Data Validation
  ---
  duration_ms: 4.3849
  type: 'suite'
  ...
# Subtest: Phone Number Validation
    # Subtest: should accept valid phone numbers
    ok 1 - should accept valid phone numbers
      ---
      duration_ms: 0.3971
      type: 'test'
      ...
    # Subtest: should reject invalid phone numbers
    ok 2 - should reject invalid phone numbers
      ---
      duration_ms: 0.2225
      type: 'test'
      ...
    # Subtest: should accept empty/null phone (optional)
    ok 3 - should accept empty/null phone (optional)
      ---
      duration_ms: 0.2719
      type: 'test'
      ...
    1..3
ok 32 - Phone Number Validation
  ---
  duration_ms: 1.4219
  type: 'suite'
  ...
# Subtest: Student Promotion Business Rules
    # Subtest: should allow X to XI promotion
    ok 1 - should allow X to XI promotion
      ---
      duration_ms: 0.4697
      type: 'test'
      ...
    # Subtest: should allow XI to XII promotion
    ok 2 - should allow XI to XII promotion
      ---
      duration_ms: 0.2774
      type: 'test'
      ...
    # Subtest: should reject XII promotion (sudah lulus)
    ok 3 - should reject XII promotion (sudah lulus)
      ---
      duration_ms: 0.359
      type: 'test'
      ...
    # Subtest: should reject invalid promotion path (X to XII)
    ok 4 - should reject invalid promotion path (X to XII)
      ---
      duration_ms: 0.4036
      type: 'test'
      ...
    # Subtest: should reject downgrade (XI to X)
    ok 5 - should reject downgrade (XI to X)
      ---
      duration_ms: 0.1738
      type: 'test'
      ...
    1..5
ok 33 - Student Promotion Business Rules
  ---
  duration_ms: 2.3035
  type: 'suite'
  ...
# [32m2026-02-19 05:48:58.268 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.270 | INFO  | TeacherData [req_mlt1jaqm_44f221eb] | GetAll started {"page":1,"limit":15,"search":""}[0m
# [32m2026-02-19 05:48:58.271 | INFO  | TeacherData [req_mlt1jaqm_44f221eb] | GetAll completed {"count":2,"total":2,"page":1}[0m
# [32m2026-02-19 05:48:58.273 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.273 | INFO  | TeacherData [req_mlt1jaqp_56528a26] | GetAll started {"page":1,"limit":15,"search":""}[0m
# [31m2026-02-19 05:48:58.274 | ERROR | TeacherData [req_mlt1jaqp_56528a26] | Database query failed {} | Error: DB Error[0m
# [req_1771480138275_b3096dc8] Error: {
#   message: 'DB Error',
#   code: undefined,
#   stack: 'Error: DB Error\\n' +
#     '    at Object.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:67:71)\\n' +
#     '    at Object.apply (node:internal/test_runner/mock/mock:765:20)\\n' +
#     '    at Object.query (file:///D:/CODING/absenta-13-v3/server/config/db.js:33:41)\\n' +
#     '    at Module.getTeachersPaginated (file:///D:/CODING/absenta-13-v3/server/services/teacherService.js:62:29)\\n' +
#     '    at Module.getTeachersData (file:///D:/CODING/absenta-13-v3/server/controllers/teacherDataController.js:31:45)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:69:41)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:48:58.276 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.278 | INFO  | TeacherData [req_mlt1jaqu_4ded5ac5] | Create started {"nama":"Guru Baru"}[0m
# [33m2026-02-19 05:48:58.278 | WARN  | TeacherData [req_mlt1jaqu_4ded5ac5] | Validation failed {"field":"required_fields","value":null,"reason":"NIP, nama, jenis_kelamin required"}[0m
# [req_1771480138279_5698bd5e] Error: {
#   message: 'NIP, nama, dan jenis kelamin wajib diisi',
#   code: 2001,
#   stack: 'AppError: NIP, nama, dan jenis kelamin wajib diisi\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at Module.addTeacherData (file:///D:/CODING/absenta-13-v3/server/controllers/teacherDataController.js:62:20)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:80:41)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:48:58.280 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.281 | INFO  | TeacherData [req_mlt1jaqx_a3621960] | Create started {"nip":"123","nama":"Guru"}[0m
# [33m2026-02-19 05:48:58.281 | WARN  | TeacherData [req_mlt1jaqx_a3621960] | Create failed - NIP exists {"nip":"123"}[0m
# [req_1771480138282_9cdac18a] Error: {
#   message: 'NIP sudah terdaftar',
#   code: 1003,
#   stack: 'AppError: NIP sudah terdaftar\\n' +
#     '    at sendDuplicateError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:244:19)\\n' +
#     '    at Module.addTeacherData (file:///D:/CODING/absenta-13-v3/server/controllers/teacherDataController.js:73:24)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:101:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:48:58.282 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.283 | INFO  | TeacherData [req_mlt1jaqz_1f55f2e3] | Create started {"nip":"123","nama":"Guru Baru"}[0m
# Subtest: Teacher Data Controller
    # Subtest: getTeachersData
        # Subtest: should return teacher list
        ok 1 - should return teacher list
          ---
          duration_ms: 4.3256
          type: 'test'
          ...
        # Subtest: should handle database errors
        ok 2 - should handle database errors
          ---
          duration_ms: 3.084
          type: 'test'
          ...
        1..2
    ok 1 - getTeachersData
      ---
      duration_ms: 8.5764
      type: 'suite'
      ...
    # Subtest: addTeacherData
        # Subtest: should fail if missing required fields
        ok 1 - should fail if missing required fields
          ---
          duration_ms: 3.5964
          type: 'test'
          ...
        # Subtest: should fail if NIP exists
        ok 2 - should fail if NIP exists
          ---
          duration_ms: 2.1762
          type: 'test'
          ...
# [32m2026-02-19 05:48:58.351 | INFO  | TeacherData [req_mlt1jaqz_1f55f2e3] | Create completed {"guruId":5,"nip":"123","nama":"Guru Baru"}[0m
# [32m2026-02-19 05:48:58.352 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.353 | INFO  | TeacherData [req_mlt1jasx_6a686724] | Delete started {"id":1}[0m
# [32m2026-02-19 05:48:58.353 | INFO  | TeacherData [req_mlt1jasx_6a686724] | Delete completed {"id":1}[0m
# [32m2026-02-19 05:48:58.354 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:48:58.354 | INFO  | TeacherData [req_mlt1jasy_0bf1c713] | Delete started {"id":999}[0m
# [33m2026-02-19 05:48:58.354 | WARN  | TeacherData [req_mlt1jasy_0bf1c713] | Delete failed - not found {"id":999}[0m
# [req_1771480138354_46b64e48] Error: {
#   message: 'Data guru tidak ditemukan',
#   code: 1005,
#   stack: 'AppError: Data guru tidak ditemukan\\n' +
#     '    at sendNotFoundError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:236:19)\\n' +
#     '    at Module.deleteTeacherData (file:///D:/CODING/absenta-13-v3/server/controllers/teacherDataController.js:136:24)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:190:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
        # Subtest: should create teacher successfully
        ok 3 - should create teacher successfully
          ---
          duration_ms: 69.9363
          type: 'test'
          ...
        1..3
    ok 2 - addTeacherData
      ---
      duration_ms: 76.1959
      type: 'suite'
      ...
    # Subtest: deleteTeacherData
        # Subtest: should delete existing teacher
        ok 1 - should delete existing teacher
          ---
          duration_ms: 1.0892
          type: 'test'
          ...
        # Subtest: should return 404 if not found
        ok 2 - should return 404 if not found
          ---
          duration_ms: 1.1518
          type: 'test'
          ...
        1..2
    ok 3 - deleteTeacherData
      ---
      duration_ms: 2.5571
      type: 'suite'
      ...
    1..3
ok 34 - Teacher Data Controller
  ---
  duration_ms: 88.2004
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: HARI Constants
    # Subtest: should have 7 days in HARI_INDONESIA
    ok 1 - should have 7 days in HARI_INDONESIA
      ---
      duration_ms: 1.3127
      type: 'test'
      ...
    # Subtest: should start with Minggu (Sunday)
    ok 2 - should start with Minggu (Sunday)
      ---
      duration_ms: 0.2031
      type: 'test'
      ...
    # Subtest: should have 6 school days
    ok 3 - should have 6 school days
      ---
      duration_ms: 0.1964
      type: 'test'
      ...
    # Subtest: should not include Minggu in school days
    ok 4 - should not include Minggu in school days
      ---
      duration_ms: 0.3214
      type: 'test'
      ...
    1..4
ok 35 - HARI Constants
  ---
  duration_ms: 3.7153
  type: 'suite'
  ...
# Subtest: getHariFromDate
    # Subtest: should return correct day for known date
    ok 1 - should return correct day for known date
      ---
      duration_ms: 0.4865
      type: 'test'
      ...
    # Subtest: should return Minggu for Sunday
    ok 2 - should return Minggu for Sunday
      ---
      duration_ms: 0.182
      type: 'test'
      ...
    1..2
ok 36 - getHariFromDate
  ---
  duration_ms: 0.9106
  type: 'suite'
  ...
# Subtest: formatWIBDate
    # Subtest: should return YYYY-MM-DD format
    ok 1 - should return YYYY-MM-DD format
      ---
      duration_ms: 27.9733
      type: 'test'
      ...
    # Subtest: should format correctly for known date
    ok 2 - should format correctly for known date
      ---
      duration_ms: 0.5884
      type: 'test'
      ...
    1..2
ok 37 - formatWIBDate
  ---
  duration_ms: 29.0893
  type: 'suite'
  ...
# Subtest: parseDateStringWIB
    # Subtest: should parse valid date string
    ok 1 - should parse valid date string
      ---
      duration_ms: 0.4761
      type: 'test'
      ...
    # Subtest: should throw for invalid format
    ok 2 - should throw for invalid format
      ---
      duration_ms: 0.9016
      type: 'test'
      ...
    1..2
ok 38 - parseDateStringWIB
  ---
  duration_ms: 1.5498
  type: 'suite'
  ...
# Subtest: getDaysDifferenceWIB
    # Subtest: should return 0 for same date
    ok 1 - should return 0 for same date
      ---
      duration_ms: 0.1847
      type: 'test'
      ...
    # Subtest: should return positive for later date
    ok 2 - should return positive for later date
      ---
      duration_ms: 0.1181
      type: 'test'
      ...
    # Subtest: should return negative for earlier date
    ok 3 - should return negative for earlier date
      ---
      duration_ms: 0.1285
      type: 'test'
      ...
    1..3
ok 39 - getDaysDifferenceWIB
  ---
  duration_ms: 0.6312
  type: 'suite'
  ...
# Subtest: formatWIBTimeWithSeconds
    # Subtest: should return HH:mm:ss format
    ok 1 - should return HH:mm:ss format
      ---
      duration_ms: 2.5573
      type: 'test'
      ...
    1..1
ok 40 - formatWIBTimeWithSeconds
  ---
  duration_ms: 2.67
  type: 'suite'
  ...
# Subtest: attendanceConstants helpers
    # Subtest: isPresent
        # Subtest: returns true for present statuses and short codes
        ok 1 - returns true for present statuses and short codes
          ---
          duration_ms: 1.1324
          type: 'test'
          ...
        # Subtest: trims whitespace before checking
        ok 2 - trims whitespace before checking
          ---
          duration_ms: 0.381
          type: 'test'
          ...
        # Subtest: is case sensitive and rejects nullish/empty values
        ok 3 - is case sensitive and rejects nullish/empty values
          ---
          duration_ms: 0.2075
          type: 'test'
          ...
        1..3
    ok 1 - isPresent
      ---
      duration_ms: 2.9651
      type: 'suite'
      ...
    # Subtest: isAbsent
        # Subtest: returns true for full statuses and short codes
        ok 1 - returns true for full statuses and short codes
          ---
          duration_ms: 0.2829
          type: 'test'
          ...
        # Subtest: handles trimmed inputs
        ok 2 - handles trimmed inputs
          ---
          duration_ms: 0.1839
          type: 'test'
          ...
        # Subtest: is case sensitive and guards against empty values
        ok 3 - is case sensitive and guards against empty values
          ---
          duration_ms: 0.3277
          type: 'test'
          ...
        1..3
    ok 2 - isAbsent
      ---
      duration_ms: 1.2212
      type: 'suite'
      ...
    # Subtest: getAbsenceCategory
        # Subtest: categorizes sickness, permission, and alpha variants
        ok 1 - categorizes sickness, permission, and alpha variants
          ---
          duration_ms: 0.4975
          type: 'test'
          ...
        # Subtest: returns null for unknown, empty, or mismatched case inputs
        ok 2 - returns null for unknown, empty, or mismatched case inputs
          ---
          duration_ms: 0.2131
          type: 'test'
          ...
        1..2
    ok 3 - getAbsenceCategory
      ---
      duration_ms: 1.0735
      type: 'suite'
      ...
    # Subtest: normalizeStatus
        # Subtest: maps short codes to full status names case-insensitively
        ok 1 - maps short codes to full status names case-insensitively
          ---
          duration_ms: 0.4435
          type: 'test'
          ...
        # Subtest: returns trimmed original values when no mapping exists
        ok 2 - returns trimmed original values when no mapping exists
          ---
          duration_ms: 0.3785
          type: 'test'
          ...
        # Subtest: returns null for missing or empty values
        ok 3 - returns null for missing or empty values
          ---
          duration_ms: 0.3067
          type: 'test'
          ...
        1..3
    ok 4 - normalizeStatus
      ---
      duration_ms: 1.3769
      type: 'suite'
      ...
    1..4
ok 41 - attendanceConstants helpers
  ---
  duration_ms: 8.0144
  type: 'suite'
  ...
# [dotenv@17.2.3] injecting env (24) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
# [req_1771480138361_3d6fa9af] Error: {
#   message: 'Token tidak valid atau kadaluarsa',
#   code: 3001,
#   stack: 'AppError: Token tidak valid atau kadaluarsa\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:26:43\\n' +
#     '    at D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:171:14\\n' +
#     '    at getSecret (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:97:14)\\n' +
#     '    at module.exports [as verify] (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:101:10)\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:21:9)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/middleware/__tests__/auth.test.js:77:7)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)'
# }
# Subtest: auth middleware
    # Subtest: authenticateToken
        # Subtest: attaches user and calls next when token is valid
        ok 1 - attaches user and calls next when token is valid
          ---
          duration_ms: 7.492
          type: 'test'
          ...
# [req_1771480138364_ab102b36] Error: {
#   message: 'Token akses diperlukan',
#   code: 3001,
#   stack: 'AppError: Token akses diperlukan\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:18:39)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/middleware/__tests__/auth.test.js:98:7)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
        # Subtest: returns 401 when token verification fails
        ok 2 - returns 401 when token verification fails
          ---
          duration_ms: 3.5104
          type: 'test'
          ...
# [req_1771480138365_977da1d5] Error: {
#   message: 'Pengguna belum terautentikasi',
#   code: 3001,
#   stack: 'AppError: Pengguna belum terautentikasi\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:39:43\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/middleware/__tests__/auth.test.js:130:7)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [req_1771480138366_a046856e] Error: {
#   message: 'Anda tidak memiliki izin untuk akses ini',
#   code: 3002,
#   stack: 'AppError: Anda tidak memiliki izin untuk akses ini\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:42:43\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/middleware/__tests__/auth.test.js:146:7)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
        # Subtest: returns 401 when token is missing
        ok 3 - returns 401 when token is missing
          ---
          duration_ms: 0.8339
          type: 'test'
          ...
        1..3
    ok 1 - authenticateToken
      ---
      duration_ms: 12.6632
      type: 'suite'
      ...
    # Subtest: requireRole
        # Subtest: allows access when role is permitted
        ok 1 - allows access when role is permitted
          ---
          duration_ms: 0.2648
          type: 'test'
          ...
        # Subtest: denies access when user role is missing
        ok 2 - denies access when user role is missing
          ---
          duration_ms: 0.5363
          type: 'test'
          ...
        # Subtest: denies access when role is not permitted
        ok 3 - denies access when role is not permitted
          ---
          duration_ms: 0.4316
          type: 'test'
          ...
        1..3
    ok 2 - requireRole
      ---
      duration_ms: 1.4878
      type: 'suite'
      ...
    1..2
ok 42 - auth middleware
  ---
  duration_ms: 39.6683
  type: 'suite'
  ...
# [dotenv@17.2.3] injecting env (24) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops
# Subtest: download routes
    # Subtest: allows owner to download file
    ok 1 - allows owner to download file
      ---
      duration_ms: 20.1344
      type: 'test'
      ...
# [req_1771480138772_501b2266] Error: {
#   message: 'Akses ditolak',
#   code: 3002,
#   stack: 'AppError: Akses ditolak\\n' +
#     '    at sendPermissionError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:252:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2641:20)\\n' +
#     '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)'
# }
    # Subtest: denies access to other user file
    ok 2 - denies access to other user file
      ---
      duration_ms: 5.9097
      type: 'test'
      ...
# [req_1771480138776_3d5338bc] Error: {
#   message: 'Nama file tidak valid',
#   code: 2001,
#   stack: 'AppError: Nama file tidak valid\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2631:20)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:44:9\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:31:9\\n' +
#     '    at D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:261:12\\n' +
#     '    at getSecret (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:97:14)\\n' +
#     '    at module.exports [as verify] (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:101:10)\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:21:9)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at Route.dispatch (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:117:3)\\n' +
#     '    at handle (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\index.js:435:11)'
# }
# [req_1771480138778_1a2505a1] Error: {
#   message: 'Nama file tidak valid',
#   code: 2001,
#   stack: 'AppError: Nama file tidak valid\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2631:20)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:44:9\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:31:9\\n' +
#     '    at D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:261:12\\n' +
#     '    at getSecret (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:97:14)\\n' +
#     '    at module.exports [as verify] (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:101:10)\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:21:9)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at Route.dispatch (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:117:3)\\n' +
#     '    at handle (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\index.js:435:11)'
# }
    # Subtest: blocks path traversal patterns
    ok 3 - blocks path traversal patterns
      ---
      duration_ms: 4.9296
      type: 'test'
      ...
# [req_1771480138782_b348d172] Error: {
#   message: 'Nama file tidak valid',
#   code: 2001,
#   stack: 'AppError: Nama file tidak valid\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2631:20)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:44:9\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:31:9\\n' +
#     '    at D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:261:12\\n' +
#     '    at getSecret (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:97:14)\\n' +
#     '    at module.exports [as verify] (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:101:10)\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:21:9)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at Route.dispatch (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:117:3)\\n' +
#     '    at handle (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\index.js:435:11)'
# }
    # Subtest: blocks non-xlsx extensions
    ok 4 - blocks non-xlsx extensions
      ---
      duration_ms: 3.3346
      type: 'test'
      ...
# [req_1771480138786_04a53b9d] Error: {
#   message: 'Nama file tidak valid',
#   code: 2001,
#   stack: 'AppError: Nama file tidak valid\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2662:20)'
# }
    # Subtest: blocks symlink escape attempts
    ok 5 - blocks symlink escape attempts
      ---
      duration_ms: 5.0991
      type: 'test'
      ...
    1..5
ok 43 - download routes
  ---
  duration_ms: 341.2335
  type: 'suite'
  ...
1..43
# tests 185
# suites 59
# pass 185
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 796.3007
