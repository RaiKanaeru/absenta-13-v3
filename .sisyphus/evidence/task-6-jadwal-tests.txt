
> absenta-13@1.0.0 test:server
> node --test server/**/__tests__/**/*.test.js

TAP version 13
# [32m2026-02-19 05:46:11.555 | INFO  | DB  | Database pool registered in centralized config[0m
# Subtest: Attendance Calculator
    # Subtest: getEffectiveDaysMapFromDB
    not ok 1 - getEffectiveDaysMapFromDB
      ---
      duration_ms: 0.5558
      type: 'suite'
      location: 'D:\\CODING\\absenta-13-v3\\server\\__tests__\\attendanceCalculator.test.js:42:5'
      failureType: 'testCodeFailure'
      error: 'beforeEach is not defined'
      code: 'ERR_TEST_FAILURE'
      name: 'ReferenceError'
      stack: |-
        SuiteContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/attendanceCalculator.test.js:43:9)
        Suite.runInAsyncScope (node:async_hooks:214:14)
        Suite.createBuild (node:internal/test_runner/test:1402:13)
        new Suite (node:internal/test_runner/test:1393:28)
        Suite.createSubtest (node:internal/test_runner/test:808:18)
        run (node:internal/test_runner/harness:302:28)
        test (node:internal/test_runner/harness:316:12)
        SuiteContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/attendanceCalculator.test.js:42:5)
        Suite.runInAsyncScope (node:async_hooks:214:14)
        Suite.createBuild (node:internal/test_runner/test:1402:13)
      ...
    # Subtest: calculateEffectiveDaysForRange
    not ok 2 - calculateEffectiveDaysForRange
      ---
      duration_ms: 0.1465
      type: 'suite'
      location: 'D:\\CODING\\absenta-13-v3\\server\\__tests__\\attendanceCalculator.test.js:70:5'
      failureType: 'testCodeFailure'
      error: 'beforeEach is not defined'
      code: 'ERR_TEST_FAILURE'
      name: 'ReferenceError'
      stack: |-
        SuiteContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/attendanceCalculator.test.js:71:9)
        Suite.runInAsyncScope (node:async_hooks:214:14)
        Suite.createBuild (node:internal/test_runner/test:1402:13)
        new Suite (node:internal/test_runner/test:1393:28)
        Suite.createSubtest (node:internal/test_runner/test:808:18)
        run (node:internal/test_runner/harness:302:28)
        test (node:internal/test_runner/harness:316:12)
        SuiteContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/attendanceCalculator.test.js:70:5)
        Suite.runInAsyncScope (node:async_hooks:214:14)
        Suite.createBuild (node:internal/test_runner/test:1402:13)
      ...
    # Subtest: calculateAttendancePercentage
        # Subtest: should calculate basic percentage
        ok 1 - should calculate basic percentage
          ---
          duration_ms: 0.8814
          type: 'test'
          ...
        # Subtest: should cap at 100% and flag capped
        ok 2 - should cap at 100% and flag capped
          ---
          duration_ms: 0.5602
          type: 'test'
          ...
        # Subtest: should handle zero effective days
        ok 3 - should handle zero effective days
          ---
          duration_ms: 0.3676
          type: 'test'
          ...
        1..3
    ok 3 - calculateAttendancePercentage
      ---
      duration_ms: 2.7204
      type: 'suite'
      ...
    1..3
not ok 1 - Attendance Calculator
  ---
  duration_ms: 5.3169
  type: 'suite'
  location: 'D:\\CODING\\absenta-13-v3\\server\\__tests__\\attendanceCalculator.test.js:40:1'
  failureType: 'subtestsFailed'
  error: '2 subtests failed'
  code: 'ERR_TEST_FAILURE'
  ...
# [33m2026-02-19 05:46:11.570 | WARN  | AttendanceCalculator  | Attendance percentage exceeds 100% - possible data inconsistency {"hadirCount":22,"totalEffectiveDays":20,"rawPercentage":"110.00","context":""}[0m
# [33m2026-02-19 05:46:11.571 | WARN  | AttendanceCalculator  | Total effective days is zero or negative {"totalEffectiveDays":0,"context":""}[0m
# Run tests with: node --test server/__tests__/auth.test.js
# Subtest: Rate Limiting
    # Subtest: should allow first login attempt
    ok 1 - should allow first login attempt
      ---
      duration_ms: 2.6547
      type: 'test'
      ...
    # Subtest: should track failed attempts
    ok 2 - should track failed attempts
      ---
      duration_ms: 0.7166
      type: 'test'
      ...
    # Subtest: should lock after max attempts
    ok 3 - should lock after max attempts
      ---
      duration_ms: 0.7947
      type: 'test'
      ...
    # Subtest: should reset attempts on success
    ok 4 - should reset attempts on success
      ---
      duration_ms: 0.6991
      type: 'test'
      ...
    1..4
ok 2 - Rate Limiting
  ---
  duration_ms: 6.6174
  type: 'suite'
  ...
# Subtest: Time Validation
    # Subtest: should validate correct time formats
    ok 1 - should validate correct time formats
      ---
      duration_ms: 0.3497
      type: 'test'
      ...
    # Subtest: should reject invalid time formats
    ok 2 - should reject invalid time formats
      ---
      duration_ms: 0.1796
      type: 'test'
      ...
    1..2
ok 3 - Time Validation
  ---
  duration_ms: 0.7666
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: Login Attempts - Lockout Logic
    # Subtest: should allow first attempt
    ok 1 - should allow first attempt
      ---
      duration_ms: 1.217
      type: 'test'
      ...
    # Subtest: should track remaining attempts
    ok 2 - should track remaining attempts
      ---
      duration_ms: 0.247
      type: 'test'
      ...
    # Subtest: should lock after max attempts
    ok 3 - should lock after max attempts
      ---
      duration_ms: 0.4152
      type: 'test'
      ...
    # Subtest: should unlock after lockout expires
    ok 4 - should unlock after lockout expires
      ---
      duration_ms: 0.2421
      type: 'test'
      ...
    1..4
ok 4 - Login Attempts - Lockout Logic
  ---
  duration_ms: 4.3575
  type: 'suite'
  ...
# Subtest: Record Failed Attempt
    # Subtest: should create new attempt record
    ok 1 - should create new attempt record
      ---
      duration_ms: 0.4022
      type: 'test'
      ...
    # Subtest: should increment count
    ok 2 - should increment count
      ---
      duration_ms: 0.1781
      type: 'test'
      ...
    # Subtest: should set lockout at max attempts
    ok 3 - should set lockout at max attempts
      ---
      duration_ms: 0.3413
      type: 'test'
      ...
    1..3
ok 5 - Record Failed Attempt
  ---
  duration_ms: 1.5982
  type: 'suite'
  ...
# Subtest: Login Input Validation
    # Subtest: should accept valid credentials
    ok 1 - should accept valid credentials
      ---
      duration_ms: 0.4759
      type: 'test'
      ...
    # Subtest: should reject empty username
    ok 2 - should reject empty username
      ---
      duration_ms: 0.3432
      type: 'test'
      ...
    # Subtest: should reject empty password
    ok 3 - should reject empty password
      ---
      duration_ms: 0.4124
      type: 'test'
      ...
    # Subtest: should reject both empty
    ok 4 - should reject both empty
      ---
      duration_ms: 0.1849
      type: 'test'
      ...
    1..4
ok 6 - Login Input Validation
  ---
  duration_ms: 1.7941
  type: 'suite'
  ...
# Subtest: JWT Token Format Validation
    # Subtest: should accept valid JWT format
    ok 1 - should accept valid JWT format
      ---
      duration_ms: 0.2731
      type: 'test'
      ...
    # Subtest: should reject token with wrong parts
    ok 2 - should reject token with wrong parts
      ---
      duration_ms: 0.1383
      type: 'test'
      ...
    # Subtest: should reject empty token
    ok 3 - should reject empty token
      ---
      duration_ms: 0.1163
      type: 'test'
      ...
    # Subtest: should reject null token
    ok 4 - should reject null token
      ---
      duration_ms: 0.1048
      type: 'test'
      ...
    1..4
ok 7 - JWT Token Format Validation
  ---
  duration_ms: 0.861
  type: 'suite'
  ...
# Subtest: Download Access Utilities
    # Subtest: should build filename with user id
    ok 1 - should build filename with user id
      ---
      duration_ms: 2.0213
      type: 'test'
      ...
    # Subtest: should extract user id from filename
    ok 2 - should extract user id from filename
      ---
      duration_ms: 1.5989
      type: 'test'
      ...
    # Subtest: should verify ownership by user id
    ok 3 - should verify ownership by user id
      ---
      duration_ms: 0.5794
      type: 'test'
      ...
    # Subtest: should reject unsafe filenames
    ok 4 - should reject unsafe filenames
      ---
      duration_ms: 3.0042
      type: 'test'
      ...
    # Subtest: should allow xlsx extension only
    ok 5 - should allow xlsx extension only
      ---
      duration_ms: 0.3442
      type: 'test'
      ...
    1..5
ok 8 - Download Access Utilities
  ---
  duration_ms: 10.0953
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: formatBytes
    # Subtest: should return "0 Bytes" for 0
    ok 1 - should return "0 Bytes" for 0
      ---
      duration_ms: 2.3891
      type: 'test'
      ...
    # Subtest: should format bytes correctly
    ok 2 - should format bytes correctly
      ---
      duration_ms: 0.2611
      type: 'test'
      ...
    # Subtest: should format KB correctly
    ok 3 - should format KB correctly
      ---
      duration_ms: 0.3093
      type: 'test'
      ...
    # Subtest: should format MB correctly
    ok 4 - should format MB correctly
      ---
      duration_ms: 0.2155
      type: 'test'
      ...
    # Subtest: should format with custom decimals
    ok 5 - should format with custom decimals
      ---
      duration_ms: 0.2071
      type: 'test'
      ...
    # Subtest: should handle large values (GB)
    ok 6 - should handle large values (GB)
      ---
      duration_ms: 0.2059
      type: 'test'
      ...
    1..6
ok 9 - formatBytes
  ---
  duration_ms: 5.4468
  type: 'suite'
  ...
# Subtest: formatNumber
    # Subtest: should format small numbers
    ok 1 - should format small numbers
      ---
      duration_ms: 28.4618
      type: 'test'
      ...
    # Subtest: should add thousand separators
    ok 2 - should add thousand separators
      ---
      duration_ms: 0.5607
      type: 'test'
      ...
    1..2
ok 10 - formatNumber
  ---
  duration_ms: 29.3891
  type: 'suite'
  ...
# Subtest: formatPercentage
    # Subtest: should format whole percentage
    ok 1 - should format whole percentage
      ---
      duration_ms: 0.4478
      type: 'test'
      ...
    # Subtest: should format decimal percentage
    ok 2 - should format decimal percentage
      ---
      duration_ms: 0.3942
      type: 'test'
      ...
    # Subtest: should respect custom decimals
    ok 3 - should respect custom decimals
      ---
      duration_ms: 0.1705
      type: 'test'
      ...
    # Subtest: should format zero
    ok 4 - should format zero
      ---
      duration_ms: 0.1245
      type: 'test'
      ...
    1..4
ok 11 - formatPercentage
  ---
  duration_ms: 1.501
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: NIP Validation
    # Subtest: should accept valid 18-digit NIP
    ok 1 - should accept valid 18-digit NIP
      ---
      duration_ms: 1.4864
      type: 'test'
      ...
    # Subtest: should accept valid 10-digit NIP
    ok 2 - should accept valid 10-digit NIP
      ---
      duration_ms: 0.2918
      type: 'test'
      ...
    # Subtest: should reject NIP with less than 10 digits
    ok 3 - should reject NIP with less than 10 digits
      ---
      duration_ms: 0.2091
      type: 'test'
      ...
    # Subtest: should reject NIP with more than 20 digits
    ok 4 - should reject NIP with more than 20 digits
      ---
      duration_ms: 0.2103
      type: 'test'
      ...
    # Subtest: should reject NIP with non-numeric characters
    ok 5 - should reject NIP with non-numeric characters
      ---
      duration_ms: 0.1825
      type: 'test'
      ...
    # Subtest: should reject empty NIP
    ok 6 - should reject empty NIP
      ---
      duration_ms: 0.1731
      type: 'test'
      ...
    1..6
ok 12 - NIP Validation
  ---
  duration_ms: 4.5754
  type: 'suite'
  ...
# Subtest: Guru Nama Validation
    # Subtest: should accept valid name
    ok 1 - should accept valid name
      ---
      duration_ms: 0.4619
      type: 'test'
      ...
    # Subtest: should accept 2-char name
    ok 2 - should accept 2-char name
      ---
      duration_ms: 0.4464
      type: 'test'
      ...
    # Subtest: should reject 1-char name
    ok 3 - should reject 1-char name
      ---
      duration_ms: 0.4453
      type: 'test'
      ...
    # Subtest: should reject empty name
    ok 4 - should reject empty name
      ---
      duration_ms: 0.4216
      type: 'test'
      ...
    # Subtest: should reject whitespace-only name
    ok 5 - should reject whitespace-only name
      ---
      duration_ms: 0.173
      type: 'test'
      ...
    1..5
ok 13 - Guru Nama Validation
  ---
  duration_ms: 2.4815
  type: 'suite'
  ...
# Subtest: Guru Username Validation
    # Subtest: should accept valid lowercase username
    ok 1 - should accept valid lowercase username
      ---
      duration_ms: 0.3246
      type: 'test'
      ...
    # Subtest: should accept username with numbers
    ok 2 - should accept username with numbers
      ---
      duration_ms: 0.1784
      type: 'test'
      ...
    # Subtest: should reject username shorter than 4 chars
    ok 3 - should reject username shorter than 4 chars
      ---
      duration_ms: 0.1148
      type: 'test'
      ...
    # Subtest: should reject username with uppercase
    ok 4 - should reject username with uppercase
      ---
      duration_ms: 1.1518
      type: 'test'
      ...
    # Subtest: should reject username with spaces
    ok 5 - should reject username with spaces
      ---
      duration_ms: 0.1496
      type: 'test'
      ...
    1..5
ok 14 - Guru Username Validation
  ---
  duration_ms: 2.1501
  type: 'suite'
  ...
# Subtest: Guru Status Validation
    # Subtest: should accept aktif
    ok 1 - should accept aktif
      ---
      duration_ms: 0.2093
      type: 'test'
      ...
    # Subtest: should accept nonaktif
    ok 2 - should accept nonaktif
      ---
      duration_ms: 0.1725
      type: 'test'
      ...
    # Subtest: should accept empty (optional)
    ok 3 - should accept empty (optional)
      ---
      duration_ms: 0.1753
      type: 'test'
      ...
    # Subtest: should reject invalid status
    ok 4 - should reject invalid status
      ---
      duration_ms: 0.1297
      type: 'test'
      ...
    1..4
ok 15 - Guru Status Validation
  ---
  duration_ms: 0.8962
  type: 'suite'
  ...
# Subtest: Teacher Attendance Status
    # Subtest: should accept Hadir
    ok 1 - should accept Hadir
      ---
      duration_ms: 0.2637
      type: 'test'
      ...
    # Subtest: should accept Tidak Hadir
    ok 2 - should accept Tidak Hadir
      ---
      duration_ms: 0.1182
      type: 'test'
      ...
    # Subtest: should accept Izin
    ok 3 - should accept Izin
      ---
      duration_ms: 0.1037
      type: 'test'
      ...
    # Subtest: should accept Sakit
    ok 4 - should accept Sakit
      ---
      duration_ms: 0.0934
      type: 'test'
      ...
    # Subtest: should reject invalid status
    ok 5 - should reject invalid status
      ---
      duration_ms: 0.1042
      type: 'test'
      ...
    1..5
ok 16 - Teacher Attendance Status
  ---
  duration_ms: 1.0008
  type: 'suite'
  ...
# [32m2026-02-19 05:46:11.670 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.673 | INFO  | Jadwal [req_mlt1fq6x_429aae7b] | CreateJadwal started {"kelas_id":1,"mapel_id":1,"hari":"Senin","jam_ke":1}[0m
# [33m2026-02-19 05:46:11.674 | WARN  | Jadwal [req_mlt1fq6x_429aae7b] | Validation failed {"field":"time","value":{"jam_mulai":"25:00","jam_selesai":"08:00"},"reason":"Format waktu tidak valid. Gunakan format 24 jam (HH:MM)"}[0m
# [req_1771479971674_1c472ed6] Error: {
#   message: 'Format waktu tidak valid. Gunakan format 24 jam (HH:MM)',
#   code: 2001,
#   stack: 'AppError: Format waktu tidak valid. Gunakan format 24 jam (HH:MM)\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at Module.createJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1719:20)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:50:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async startSubtestAfterBootstrap (node:internal/test_runner/harness:296:3)'
# }
# [32m2026-02-19 05:46:11.678 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.679 | INFO  | Jadwal [req_mlt1fq73_b5c99e3d] | CreateJadwal started {"kelas_id":1,"mapel_id":1,"hari":"Senin","jam_ke":1}[0m
# [33m2026-02-19 05:46:11.679 | WARN  | Jadwal [req_mlt1fq73_b5c99e3d] | Validation failed {"field":"time","value":{"jam_mulai":"08:00","jam_selesai":"07:00"},"reason":"Jam selesai harus setelah jam mulai"}[0m
# [req_1771479971679_511ddbfe] Error: {
#   message: 'Jam selesai harus setelah jam mulai',
#   code: 2001,
#   stack: 'AppError: Jam selesai harus setelah jam mulai\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at Module.createJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1719:20)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:63:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:46:11.680 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.681 | INFO  | Jadwal [req_mlt1fq75_e6baa2fc] | GetJadwal started {}[0m
# [32m2026-02-19 05:46:11.682 | INFO  | Jadwal [req_mlt1fq75_e6baa2fc] | GetJadwal completed {"count":1}[0m
# [32m2026-02-19 05:46:11.682 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.683 | INFO  | Jadwal [req_mlt1fq77_f5928afc] | GetJadwal started {}[0m
# [31m2026-02-19 05:46:11.683 | ERROR | Jadwal [req_mlt1fq77_f5928afc] | Database getJadwal failed {} | Error: DB Error[0m
# [req_1771479971683_9cb8678c] Error: {
#   message: 'DB Error',
#   code: undefined,
#   stack: 'Error: DB Error\\n' +
#     '    at Object.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:82:73)\\n' +
#     '    at Object.apply (node:internal/test_runner/mock/mock:765:20)\\n' +
#     '    at Object.execute (file:///D:/CODING/absenta-13-v3/server/config/db.js:31:21)\\n' +
#     '    at Module.getJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1688:33)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:84:36)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:46:11.684 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.686 | INFO  | Jadwal [req_mlt1fq7a_b937d466] | CreateJadwal started {"kelas_id":1,"mapel_id":1,"hari":"Senin","jam_ke":1}[0m
# [32m2026-02-19 05:46:11.687 | INFO  | Jadwal [req_mlt1fq7a_b937d466] | CreateJadwal completed {"jadwalId":10,"hari":"Senin","jam_ke":1,"guruCount":1}[0m
# [32m2026-02-19 05:46:11.689 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.689 | INFO  | Jadwal [req_mlt1fq7d_d54b411f] | CreateJadwal started {}[0m
# [33m2026-02-19 05:46:11.689 | WARN  | Jadwal [req_mlt1fq7d_d54b411f] | Validation failed {"field":"jadwal","value":{"jam_mulai":"07:00","jam_selesai":"08:00","jenis_aktivitas":"pelajaran"},"reason":"Missing required fields"}[0m
# [req_1771479971689_931757e4] Error: {
#   message: 'Semua field wajib diisi',
#   code: 2001,
#   stack: 'AppError: Semua field wajib diisi\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at Module.createJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1719:20)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:128:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [32m2026-02-19 05:46:11.690 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.691 | INFO  | Jadwal [req_mlt1fq7f_9644fba2] | DeleteJadwal started {"id":1}[0m
# [32m2026-02-19 05:46:11.691 | INFO  | Jadwal [req_mlt1fq7f_9644fba2] | DeleteJadwal completed {"id":1}[0m
# [32m2026-02-19 05:46:11.691 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.691 | INFO  | Jadwal [req_mlt1fq7f_30fb65df] | DeleteJadwal started {"id":999}[0m
# [33m2026-02-19 05:46:11.692 | WARN  | Jadwal [req_mlt1fq7f_30fb65df] | DeleteJadwal - not found {"id":999}[0m
# [req_1771479971692_02642dd3] Error: {
#   message: 'Jadwal tidak ditemukan',
#   code: 1005,
#   stack: 'AppError: Jadwal tidak ditemukan\\n' +
#     '    at sendNotFoundError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:236:19)\\n' +
#     '    at Module.deleteJadwal (file:///D:/CODING/absenta-13-v3/server/controllers/jadwalController.js:1851:20)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/jadwal.test.js:150:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# Subtest: Jadwal Controller
    # Subtest: Helper Logic Validation (via createJadwal)
        # Subtest: should reject invalid time format
        ok 1 - should reject invalid time format
          ---
          duration_ms: 7.8152
          type: 'test'
          ...
        # Subtest: should reject if end time is before start time
        ok 2 - should reject if end time is before start time
          ---
          duration_ms: 1.5589
          type: 'test'
          ...
        1..2
    ok 1 - Helper Logic Validation (via createJadwal)
      ---
      duration_ms: 10.5458
      type: 'suite'
      ...
    # Subtest: getJadwal
        # Subtest: should return all schedules
        ok 1 - should return all schedules
          ---
          duration_ms: 1.7667
          type: 'test'
          ...
        # Subtest: should handle database errors
        ok 2 - should handle database errors
          ---
          duration_ms: 1.7301
          type: 'test'
          ...
        1..2
    ok 2 - getJadwal
      ---
      duration_ms: 3.8131
      type: 'suite'
      ...
    # Subtest: createJadwal
        # Subtest: should create valid schedule
        ok 1 - should create valid schedule
          ---
          duration_ms: 4.5031
          type: 'test'
          ...
        # Subtest: should fail if missing required fields
        ok 2 - should fail if missing required fields
          ---
          duration_ms: 0.9456
          type: 'test'
          ...
        1..2
    ok 3 - createJadwal
      ---
      duration_ms: 5.9302
      type: 'suite'
      ...
    # Subtest: deleteJadwal
        # Subtest: should delete existing schedule
        ok 1 - should delete existing schedule
          ---
          duration_ms: 0.8224
          type: 'test'
          ...
        # Subtest: should return 404 if not found
        ok 2 - should return 404 if not found
          ---
          duration_ms: 1.0362
          type: 'test'
          ...
        1..2
    ok 4 - deleteJadwal
      ---
      duration_ms: 2.1112
      type: 'suite'
      ...
    1..4
ok 17 - Jadwal Controller
  ---
  duration_ms: 23.4851
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: Time Format Validation
    # Subtest: should accept HH:MM format
    ok 1 - should accept HH:MM format
      ---
      duration_ms: 1.5757
      type: 'test'
      ...
    # Subtest: should accept H:MM format
    ok 2 - should accept H:MM format
      ---
      duration_ms: 0.242
      type: 'test'
      ...
    # Subtest: should accept HH:MM:SS format
    ok 3 - should accept HH:MM:SS format
      ---
      duration_ms: 0.2128
      type: 'test'
      ...
    # Subtest: should reject invalid hours
    ok 4 - should reject invalid hours
      ---
      duration_ms: 0.3531
      type: 'test'
      ...
    # Subtest: should reject invalid minutes
    ok 5 - should reject invalid minutes
      ---
      duration_ms: 0.1903
      type: 'test'
      ...
    # Subtest: should reject invalid format
    ok 6 - should reject invalid format
      ---
      duration_ms: 0.1798
      type: 'test'
      ...
    1..6
ok 18 - Time Format Validation
  ---
  duration_ms: 4.8016
  type: 'suite'
  ...
# Subtest: Time Range Validation
    # Subtest: should accept valid range (mulai < selesai)
    ok 1 - should accept valid range (mulai < selesai)
      ---
      duration_ms: 0.5141
      type: 'test'
      ...
    # Subtest: should reject invalid range (mulai >= selesai)
    ok 2 - should reject invalid range (mulai >= selesai)
      ---
      duration_ms: 0.4588
      type: 'test'
      ...
    # Subtest: should handle edge cases
    ok 3 - should handle edge cases
      ---
      duration_ms: 0.4104
      type: 'test'
      ...
    # Subtest: should reject null/empty values
    ok 4 - should reject null/empty values
      ---
      duration_ms: 0.4827
      type: 'test'
      ...
    1..4
ok 19 - Time Range Validation
  ---
  duration_ms: 2.3795
  type: 'suite'
  ...
# Subtest: Jam Ke Range Validation
    # Subtest: should accept valid jam_ke (1-15)
    ok 1 - should accept valid jam_ke (1-15)
      ---
      duration_ms: 0.2869
      type: 'test'
      ...
    # Subtest: should reject jam_ke below minimum
    ok 2 - should reject jam_ke below minimum
      ---
      duration_ms: 0.1407
      type: 'test'
      ...
    # Subtest: should reject jam_ke above maximum
    ok 3 - should reject jam_ke above maximum
      ---
      duration_ms: 0.1129
      type: 'test'
      ...
    # Subtest: should reject null/undefined
    ok 4 - should reject null/undefined
      ---
      duration_ms: 0.1294
      type: 'test'
      ...
    # Subtest: should accept string numbers
    ok 5 - should accept string numbers
      ---
      duration_ms: 0.1175
      type: 'test'
      ...
    1..5
ok 20 - Jam Ke Range Validation
  ---
  duration_ms: 1.0422
  type: 'suite'
  ...
# Subtest: Duplicate Jam Ke Detection
    # Subtest: should detect no duplicates
    ok 1 - should detect no duplicates
      ---
      duration_ms: 2.4517
      type: 'test'
      ...
    # Subtest: should detect duplicates
    ok 2 - should detect duplicates
      ---
      duration_ms: 0.1922
      type: 'test'
      ...
    # Subtest: should handle empty array
    ok 3 - should handle empty array
      ---
      duration_ms: 0.1335
      type: 'test'
      ...
    1..3
ok 21 - Duplicate Jam Ke Detection
  ---
  duration_ms: 2.9603
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: Kelas - Tingkat Extraction
    # Subtest: should extract X from "X IPA 1"
    ok 1 - should extract X from "X IPA 1"
      ---
      duration_ms: 2.494
      type: 'test'
      ...
    # Subtest: should extract XI from "XI RPL 2"
    ok 2 - should extract XI from "XI RPL 2"
      ---
      duration_ms: 0.2486
      type: 'test'
      ...
    # Subtest: should extract XII from "XII TKJ 3"
    ok 3 - should extract XII from "XII TKJ 3"
      ---
      duration_ms: 0.2242
      type: 'test'
      ...
    # Subtest: should return null for empty string
    ok 4 - should return null for empty string
      ---
      duration_ms: 0.3074
      type: 'test'
      ...
    # Subtest: should return null for null input
    ok 5 - should return null for null input
      ---
      duration_ms: 0.1838
      type: 'test'
      ...
    1..5
ok 22 - Kelas - Tingkat Extraction
  ---
  duration_ms: 5.1279
  type: 'suite'
  ...
# Subtest: Kelas - Safe Delete Check
    # Subtest: should allow delete when no dependencies
    ok 1 - should allow delete when no dependencies
      ---
      duration_ms: 0.332
      type: 'test'
      ...
    # Subtest: should block delete when has students
    ok 2 - should block delete when has students
      ---
      duration_ms: 0.4848
      type: 'test'
      ...
    # Subtest: should block delete when has jadwal
    ok 3 - should block delete when has jadwal
      ---
      duration_ms: 0.4766
      type: 'test'
      ...
    # Subtest: should report both reasons when has both
    ok 4 - should report both reasons when has both
      ---
      duration_ms: 0.3681
      type: 'test'
      ...
    1..4
ok 23 - Kelas - Safe Delete Check
  ---
  duration_ms: 2.4484
  type: 'suite'
  ...
# Subtest: Ruang - Kode Validation
    # Subtest: should validate and uppercase valid code
    ok 1 - should validate and uppercase valid code
      ---
      duration_ms: 0.472
      type: 'test'
      ...
    # Subtest: should reject empty code
    ok 2 - should reject empty code
      ---
      duration_ms: 0.1969
      type: 'test'
      ...
    # Subtest: should reject code longer than 10 chars
    ok 3 - should reject code longer than 10 chars
      ---
      duration_ms: 0.1793
      type: 'test'
      ...
    # Subtest: should accept exactly 10 chars
    ok 4 - should accept exactly 10 chars
      ---
      duration_ms: 0.1383
      type: 'test'
      ...
    1..4
ok 24 - Ruang - Kode Validation
  ---
  duration_ms: 1.2746
  type: 'suite'
  ...
# [dotenv@17.2.3] injecting env (25) from .env -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
# Subtest: DownloadQueue file access
    # Subtest: purges expired file access entries
    ok 1 - purges expired file access entries
      ---
      duration_ms: 0.9043
      type: 'test'
      ...
    # Subtest: falls back to filename ownership when map entry expired
    ok 2 - falls back to filename ownership when map entry expired
      ---
      duration_ms: 0.4146
      type: 'test'
      ...
    # Subtest: removes filepath from job status result
    ok 3 - removes filepath from job status result
      ---
      duration_ms: 0.5956
      type: 'test'
      ...
    1..3
ok 25 - DownloadQueue file access
  ---
  duration_ms: 2.958
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: NIS Validation
    # Subtest: should accept valid 10-digit NIS
    ok 1 - should accept valid 10-digit NIS
      ---
      duration_ms: 1.4009
      type: 'test'
      ...
    # Subtest: should accept valid 8-digit NIS
    ok 2 - should accept valid 8-digit NIS
      ---
      duration_ms: 0.3363
      type: 'test'
      ...
    # Subtest: should accept valid 15-digit NIS
    ok 3 - should accept valid 15-digit NIS
      ---
      duration_ms: 0.239
      type: 'test'
      ...
    # Subtest: should reject NIS with less than 8 digits
    ok 4 - should reject NIS with less than 8 digits
      ---
      duration_ms: 0.2454
      type: 'test'
      ...
    # Subtest: should reject NIS with more than 15 digits
    ok 5 - should reject NIS with more than 15 digits
      ---
      duration_ms: 0.22
      type: 'test'
      ...
    # Subtest: should reject NIS with non-numeric characters
    ok 6 - should reject NIS with non-numeric characters
      ---
      duration_ms: 0.1888
      type: 'test'
      ...
    # Subtest: should reject empty NIS
    ok 7 - should reject empty NIS
      ---
      duration_ms: 0.2835
      type: 'test'
      ...
    1..7
ok 26 - NIS Validation
  ---
  duration_ms: 4.9717
  type: 'suite'
  ...
# Subtest: Username Validation
    # Subtest: should accept valid lowercase username
    ok 1 - should accept valid lowercase username
      ---
      duration_ms: 0.548
      type: 'test'
      ...
    # Subtest: should accept username with underscore
    ok 2 - should accept username with underscore
      ---
      duration_ms: 0.5485
      type: 'test'
      ...
    # Subtest: should reject username shorter than 4 chars
    ok 3 - should reject username shorter than 4 chars
      ---
      duration_ms: 0.4672
      type: 'test'
      ...
    # Subtest: should reject username with uppercase
    ok 4 - should reject username with uppercase
      ---
      duration_ms: 0.2112
      type: 'test'
      ...
    # Subtest: should reject username with spaces
    ok 5 - should reject username with spaces
      ---
      duration_ms: 0.1526
      type: 'test'
      ...
    1..5
ok 27 - Username Validation
  ---
  duration_ms: 2.5754
  type: 'suite'
  ...
# Subtest: Email Validation
    # Subtest: should accept valid email
    ok 1 - should accept valid email
      ---
      duration_ms: 0.3576
      type: 'test'
      ...
    # Subtest: should accept empty email (optional)
    ok 2 - should accept empty email (optional)
      ---
      duration_ms: 0.1473
      type: 'test'
      ...
    # Subtest: should reject invalid email format
    ok 3 - should reject invalid email format
      ---
      duration_ms: 0.1942
      type: 'test'
      ...
    1..3
ok 28 - Email Validation
  ---
  duration_ms: 2.3109
  type: 'suite'
  ...
# Subtest: Password Validation
    # Subtest: should accept password with 6+ chars on create
    ok 1 - should accept password with 6+ chars on create
      ---
      duration_ms: 0.2771
      type: 'test'
      ...
    # Subtest: should reject short password on create
    ok 2 - should reject short password on create
      ---
      duration_ms: 0.1261
      type: 'test'
      ...
    # Subtest: should allow empty password on update
    ok 3 - should allow empty password on update
      ---
      duration_ms: 0.1009
      type: 'test'
      ...
    # Subtest: should reject short password on update if provided
    ok 4 - should reject short password on update if provided
      ---
      duration_ms: 0.099
      type: 'test'
      ...
    1..4
ok 29 - Password Validation
  ---
  duration_ms: 0.801
  type: 'suite'
  ...
# Subtest: Jenis Kelamin Validation
    # Subtest: should accept L
    ok 1 - should accept L
      ---
      duration_ms: 0.232
      type: 'test'
      ...
    # Subtest: should accept P
    ok 2 - should accept P
      ---
      duration_ms: 0.1031
      type: 'test'
      ...
    # Subtest: should accept empty (optional)
    ok 3 - should accept empty (optional)
      ---
      duration_ms: 0.1578
      type: 'test'
      ...
    # Subtest: should reject invalid value
    ok 4 - should reject invalid value
      ---
      duration_ms: 0.0846
      type: 'test'
      ...
    1..4
ok 30 - Jenis Kelamin Validation
  ---
  duration_ms: 0.8646
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: Student Data Validation
    # Subtest: should pass with valid data
    ok 1 - should pass with valid data
      ---
      duration_ms: 2.5843
      type: 'test'
      ...
    # Subtest: should fail with missing NIS
    ok 2 - should fail with missing NIS
      ---
      duration_ms: 0.3768
      type: 'test'
      ...
    # Subtest: should fail with invalid jenis_kelamin
    ok 3 - should fail with invalid jenis_kelamin
      ---
      duration_ms: 0.2644
      type: 'test'
      ...
    1..3
ok 31 - Student Data Validation
  ---
  duration_ms: 5.1796
  type: 'suite'
  ...
# Subtest: Phone Number Validation
    # Subtest: should accept valid phone numbers
    ok 1 - should accept valid phone numbers
      ---
      duration_ms: 0.3512
      type: 'test'
      ...
    # Subtest: should reject invalid phone numbers
    ok 2 - should reject invalid phone numbers
      ---
      duration_ms: 0.1746
      type: 'test'
      ...
    # Subtest: should accept empty/null phone (optional)
    ok 3 - should accept empty/null phone (optional)
      ---
      duration_ms: 0.1279
      type: 'test'
      ...
    1..3
ok 32 - Phone Number Validation
  ---
  duration_ms: 1.1301
  type: 'suite'
  ...
# Subtest: Student Promotion Business Rules
    # Subtest: should allow X to XI promotion
    ok 1 - should allow X to XI promotion
      ---
      duration_ms: 0.5626
      type: 'test'
      ...
    # Subtest: should allow XI to XII promotion
    ok 2 - should allow XI to XII promotion
      ---
      duration_ms: 0.3918
      type: 'test'
      ...
    # Subtest: should reject XII promotion (sudah lulus)
    ok 3 - should reject XII promotion (sudah lulus)
      ---
      duration_ms: 0.4372
      type: 'test'
      ...
    # Subtest: should reject invalid promotion path (X to XII)
    ok 4 - should reject invalid promotion path (X to XII)
      ---
      duration_ms: 0.4761
      type: 'test'
      ...
    # Subtest: should reject downgrade (XI to X)
    ok 5 - should reject downgrade (XI to X)
      ---
      duration_ms: 0.2111
      type: 'test'
      ...
    1..5
ok 33 - Student Promotion Business Rules
  ---
  duration_ms: 2.8359
  type: 'suite'
  ...
# [32m2026-02-19 05:46:11.758 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.760 | INFO  | TeacherData [req_mlt1fq9c_9554c5bd] | GetAll started {"page":1,"limit":15,"search":""}[0m
# [32m2026-02-19 05:46:11.761 | INFO  | TeacherData [req_mlt1fq9c_9554c5bd] | GetAll completed {"count":2,"total":2,"page":1}[0m
# [32m2026-02-19 05:46:11.763 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.763 | INFO  | TeacherData [req_mlt1fq9f_a4e97385] | GetAll started {"page":1,"limit":15,"search":""}[0m
# [32m2026-02-19 05:46:11.766 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.768 | INFO  | TeacherData [req_mlt1fq9k_74efba7e] | Create started {"nama":"Guru Baru"}[0m
# [32m2026-02-19 05:46:11.770 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.770 | INFO  | TeacherData [req_mlt1fq9m_076fae34] | Create started {"nip":"123","nama":"Guru"}[0m
# [32m2026-02-19 05:46:11.772 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.772 | INFO  | TeacherData [req_mlt1fq9o_0fff0271] | Create started {"nip":"123","nama":"Guru Baru"}[0m
# [31m2026-02-19 05:46:11.764 | ERROR | TeacherData [req_mlt1fq9f_a4e97385] | Database query failed {} | Error: DB Error[0m
# [req_1771479971764_ccd818fe] Error: {
#   message: 'DB Error',
#   code: undefined,
#   stack: 'Error: DB Error\\n' +
#     '    at Object.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:67:71)\\n' +
#     '    at Object.apply (node:internal/test_runner/mock/mock:765:20)\\n' +
#     '    at Object.query (file:///D:/CODING/absenta-13-v3/server/config/db.js:33:41)\\n' +
#     '    at Module.getTeachersPaginated (file:///D:/CODING/absenta-13-v3/server/services/teacherService.js:62:29)\\n' +
#     '    at Module.getTeachersData (file:///D:/CODING/absenta-13-v3/server/controllers/teacherDataController.js:31:45)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:69:41)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [33m2026-02-19 05:46:11.768 | WARN  | TeacherData [req_mlt1fq9k_74efba7e] | Validation failed {"field":"required_fields","value":null,"reason":"NIP, nama, jenis_kelamin required"}[0m
# [req_1771479971769_901ac563] Error: {
#   message: 'NIP, nama, dan jenis kelamin wajib diisi',
#   code: 2001,
#   stack: 'AppError: NIP, nama, dan jenis kelamin wajib diisi\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at Module.addTeacherData (file:///D:/CODING/absenta-13-v3/server/controllers/teacherDataController.js:62:20)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:80:41)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [33m2026-02-19 05:46:11.771 | WARN  | TeacherData [req_mlt1fq9m_076fae34] | Create failed - NIP exists {"nip":"123"}[0m
# [req_1771479971771_cbdb2748] Error: {
#   message: 'NIP sudah terdaftar',
#   code: 1003,
#   stack: 'AppError: NIP sudah terdaftar\\n' +
#     '    at sendDuplicateError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:244:19)\\n' +
#     '    at Module.addTeacherData (file:///D:/CODING/absenta-13-v3/server/controllers/teacherDataController.js:73:24)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:101:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# Subtest: Teacher Data Controller
    # Subtest: getTeachersData
        # Subtest: should return teacher list
        ok 1 - should return teacher list
          ---
          duration_ms: 4.8136
          type: 'test'
          ...
        # Subtest: should handle database errors
        ok 2 - should handle database errors
          ---
          duration_ms: 3.0929
          type: 'test'
          ...
        1..2
    ok 1 - getTeachersData
      ---
      duration_ms: 9.0091
      type: 'suite'
      ...
    # Subtest: addTeacherData
        # Subtest: should fail if missing required fields
        ok 1 - should fail if missing required fields
          ---
          duration_ms: 3.3732
          type: 'test'
          ...
        # Subtest: should fail if NIP exists
        ok 2 - should fail if NIP exists
          ---
          duration_ms: 2.0299
          type: 'test'
          ...
# [32m2026-02-19 05:46:11.867 | INFO  | TeacherData [req_mlt1fq9o_0fff0271] | Create completed {"guruId":5,"nip":"123","nama":"Guru Baru"}[0m
# [32m2026-02-19 05:46:11.868 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.869 | INFO  | TeacherData [req_mlt1fqcd_2d543c7b] | Delete started {"id":1}[0m
# [32m2026-02-19 05:46:11.869 | INFO  | TeacherData [req_mlt1fqcd_2d543c7b] | Delete completed {"id":1}[0m
# [32m2026-02-19 05:46:11.870 | INFO  | DB  | Database pool registered in centralized config[0m
# [32m2026-02-19 05:46:11.870 | INFO  | TeacherData [req_mlt1fqce_109ce2de] | Delete started {"id":999}[0m
# [33m2026-02-19 05:46:11.871 | WARN  | TeacherData [req_mlt1fqce_109ce2de] | Delete failed - not found {"id":999}[0m
# [req_1771479971871_09cccdc3] Error: {
#   message: 'Data guru tidak ditemukan',
#   code: 1005,
#   stack: 'AppError: Data guru tidak ditemukan\\n' +
#     '    at sendNotFoundError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:236:19)\\n' +
#     '    at Module.deleteTeacherData (file:///D:/CODING/absenta-13-v3/server/controllers/teacherDataController.js:136:24)\\n' +
#     '    at async TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/__tests__/teacherData.test.js:190:13)\\n' +
#     '    at async Test.run (node:internal/test_runner/test:1054:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
        # Subtest: should create teacher successfully
        ok 3 - should create teacher successfully
          ---
          duration_ms: 96.183
          type: 'test'
          ...
        1..3
    ok 2 - addTeacherData
      ---
      duration_ms: 102.1152
      type: 'suite'
      ...
    # Subtest: deleteTeacherData
        # Subtest: should delete existing teacher
        ok 1 - should delete existing teacher
          ---
          duration_ms: 1.4614
          type: 'test'
          ...
        # Subtest: should return 404 if not found
        ok 2 - should return 404 if not found
          ---
          duration_ms: 2.2423
          type: 'test'
          ...
        1..2
    ok 3 - deleteTeacherData
      ---
      duration_ms: 4.1247
      type: 'suite'
      ...
    1..3
ok 34 - Teacher Data Controller
  ---
  duration_ms: 116.3824
  type: 'suite'
  ...
# Run tests with: npm test
# Subtest: HARI Constants
    # Subtest: should have 7 days in HARI_INDONESIA
    ok 1 - should have 7 days in HARI_INDONESIA
      ---
      duration_ms: 1.4086
      type: 'test'
      ...
    # Subtest: should start with Minggu (Sunday)
    ok 2 - should start with Minggu (Sunday)
      ---
      duration_ms: 0.272
      type: 'test'
      ...
    # Subtest: should have 6 school days
    ok 3 - should have 6 school days
      ---
      duration_ms: 0.2488
      type: 'test'
      ...
    # Subtest: should not include Minggu in school days
    ok 4 - should not include Minggu in school days
      ---
      duration_ms: 0.398
      type: 'test'
      ...
    1..4
ok 35 - HARI Constants
  ---
  duration_ms: 4.3255
  type: 'suite'
  ...
# Subtest: getHariFromDate
    # Subtest: should return correct day for known date
    ok 1 - should return correct day for known date
      ---
      duration_ms: 0.4999
      type: 'test'
      ...
    # Subtest: should return Minggu for Sunday
    ok 2 - should return Minggu for Sunday
      ---
      duration_ms: 0.2188
      type: 'test'
      ...
    1..2
ok 36 - getHariFromDate
  ---
  duration_ms: 0.978
  type: 'suite'
  ...
# Subtest: formatWIBDate
    # Subtest: should return YYYY-MM-DD format
    ok 1 - should return YYYY-MM-DD format
      ---
      duration_ms: 29.9174
      type: 'test'
      ...
    # Subtest: should format correctly for known date
    ok 2 - should format correctly for known date
      ---
      duration_ms: 0.627
      type: 'test'
      ...
    1..2
ok 37 - formatWIBDate
  ---
  duration_ms: 31.0496
  type: 'suite'
  ...
# Subtest: parseDateStringWIB
    # Subtest: should parse valid date string
    ok 1 - should parse valid date string
      ---
      duration_ms: 0.4878
      type: 'test'
      ...
    # Subtest: should throw for invalid format
    ok 2 - should throw for invalid format
      ---
      duration_ms: 0.9681
      type: 'test'
      ...
    1..2
ok 38 - parseDateStringWIB
  ---
  duration_ms: 1.6657
  type: 'suite'
  ...
# Subtest: getDaysDifferenceWIB
    # Subtest: should return 0 for same date
    ok 1 - should return 0 for same date
      ---
      duration_ms: 0.2976
      type: 'test'
      ...
    # Subtest: should return positive for later date
    ok 2 - should return positive for later date
      ---
      duration_ms: 0.1562
      type: 'test'
      ...
    # Subtest: should return negative for earlier date
    ok 3 - should return negative for earlier date
      ---
      duration_ms: 0.1253
      type: 'test'
      ...
    1..3
ok 39 - getDaysDifferenceWIB
  ---
  duration_ms: 0.8481
  type: 'suite'
  ...
# Subtest: formatWIBTimeWithSeconds
    # Subtest: should return HH:mm:ss format
    ok 1 - should return HH:mm:ss format
      ---
      duration_ms: 2.9615
      type: 'test'
      ...
    1..1
ok 40 - formatWIBTimeWithSeconds
  ---
  duration_ms: 3.0899
  type: 'suite'
  ...
# Subtest: attendanceConstants helpers
    # Subtest: isPresent
        # Subtest: returns true for present statuses and short codes
        ok 1 - returns true for present statuses and short codes
          ---
          duration_ms: 1.2679
          type: 'test'
          ...
        # Subtest: trims whitespace before checking
        ok 2 - trims whitespace before checking
          ---
          duration_ms: 0.3901
          type: 'test'
          ...
        # Subtest: is case sensitive and rejects nullish/empty values
        ok 3 - is case sensitive and rejects nullish/empty values
          ---
          duration_ms: 0.2224
          type: 'test'
          ...
        1..3
    ok 1 - isPresent
      ---
      duration_ms: 4.4173
      type: 'suite'
      ...
    # Subtest: isAbsent
        # Subtest: returns true for full statuses and short codes
        ok 1 - returns true for full statuses and short codes
          ---
          duration_ms: 0.7033
          type: 'test'
          ...
        # Subtest: handles trimmed inputs
        ok 2 - handles trimmed inputs
          ---
          duration_ms: 0.2454
          type: 'test'
          ...
        # Subtest: is case sensitive and guards against empty values
        ok 3 - is case sensitive and guards against empty values
          ---
          duration_ms: 0.3573
          type: 'test'
          ...
        1..3
    ok 2 - isAbsent
      ---
      duration_ms: 1.9756
      type: 'suite'
      ...
    # Subtest: getAbsenceCategory
        # Subtest: categorizes sickness, permission, and alpha variants
        ok 1 - categorizes sickness, permission, and alpha variants
          ---
          duration_ms: 0.4894
          type: 'test'
          ...
        # Subtest: returns null for unknown, empty, or mismatched case inputs
        ok 2 - returns null for unknown, empty, or mismatched case inputs
          ---
          duration_ms: 0.205
          type: 'test'
          ...
        1..2
    ok 3 - getAbsenceCategory
      ---
      duration_ms: 1.1179
      type: 'suite'
      ...
    # Subtest: normalizeStatus
        # Subtest: maps short codes to full status names case-insensitively
        ok 1 - maps short codes to full status names case-insensitively
          ---
          duration_ms: 0.4778
          type: 'test'
          ...
        # Subtest: returns trimmed original values when no mapping exists
        ok 2 - returns trimmed original values when no mapping exists
          ---
          duration_ms: 0.3908
          type: 'test'
          ...
        # Subtest: returns null for missing or empty values
        ok 3 - returns null for missing or empty values
          ---
          duration_ms: 0.1633
          type: 'test'
          ...
        1..3
    ok 4 - normalizeStatus
      ---
      duration_ms: 1.2616
      type: 'suite'
      ...
    1..4
ok 41 - attendanceConstants helpers
  ---
  duration_ms: 10.7712
  type: 'suite'
  ...
# [dotenv@17.2.3] injecting env (24) from .env -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
# [req_1771479971945_7830a9de] Error: {
#   message: 'Token tidak valid atau kadaluarsa',
#   code: 3001,
#   stack: 'AppError: Token tidak valid atau kadaluarsa\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:26:43\\n' +
#     '    at D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:171:14\\n' +
#     '    at getSecret (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:97:14)\\n' +
#     '    at module.exports [as verify] (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:101:10)\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:21:9)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/middleware/__tests__/auth.test.js:77:7)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)'
# }
# Subtest: auth middleware
    # Subtest: authenticateToken
        # Subtest: attaches user and calls next when token is valid
        ok 1 - attaches user and calls next when token is valid
          ---
          duration_ms: 11.5394
          type: 'test'
          ...
# [req_1771479971948_b7221a1e] Error: {
#   message: 'Token akses diperlukan',
#   code: 3001,
#   stack: 'AppError: Token akses diperlukan\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:18:39)\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/middleware/__tests__/auth.test.js:98:7)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
        # Subtest: returns 401 when token verification fails
        ok 2 - returns 401 when token verification fails
          ---
          duration_ms: 4.801
          type: 'test'
          ...
# [req_1771479971951_8f63e470] Error: {
#   message: 'Pengguna belum terautentikasi',
#   code: 3001,
#   stack: 'AppError: Pengguna belum terautentikasi\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:39:43\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/middleware/__tests__/auth.test.js:130:7)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Promise.all (index 0)\\n' +
#     '    at async Suite.run (node:internal/test_runner/test:1442:7)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
# [req_1771479971952_7af63c9c] Error: {
#   message: 'Anda tidak memiliki izin untuk akses ini',
#   code: 3002,
#   stack: 'AppError: Anda tidak memiliki izin untuk akses ini\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:42:43\\n' +
#     '    at TestContext.<anonymous> (file:///D:/CODING/absenta-13-v3/server/middleware/__tests__/auth.test.js:146:7)\\n' +
#     '    at Test.runInAsyncScope (node:async_hooks:214:14)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1047:25)\\n' +
#     '    at Suite.processPendingSubtests (node:internal/test_runner/test:744:18)\\n' +
#     '    at Test.postRun (node:internal/test_runner/test:1173:19)\\n' +
#     '    at Test.run (node:internal/test_runner/test:1101:12)\\n' +
#     '    at async Suite.processPendingSubtests (node:internal/test_runner/test:744:7)'
# }
        # Subtest: returns 401 when token is missing
        ok 3 - returns 401 when token is missing
          ---
          duration_ms: 1.4155
          type: 'test'
          ...
        1..3
    ok 1 - authenticateToken
      ---
      duration_ms: 18.7771
      type: 'suite'
      ...
    # Subtest: requireRole
        # Subtest: allows access when role is permitted
        ok 1 - allows access when role is permitted
          ---
          duration_ms: 0.4995
          type: 'test'
          ...
        # Subtest: denies access when user role is missing
        ok 2 - denies access when user role is missing
          ---
          duration_ms: 0.9849
          type: 'test'
          ...
        # Subtest: denies access when role is not permitted
        ok 3 - denies access when role is not permitted
          ---
          duration_ms: 0.8334
          type: 'test'
          ...
        1..3
    ok 2 - requireRole
      ---
      duration_ms: 3.0633
      type: 'suite'
      ...
    1..2
ok 42 - auth middleware
  ---
  duration_ms: 63.6441
  type: 'suite'
  ...
# [dotenv@17.2.3] injecting env (24) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
# Subtest: download routes
    # Subtest: allows owner to download file
    ok 1 - allows owner to download file
      ---
      duration_ms: 27.2866
      type: 'test'
      ...
# [req_1771479972513_dd066f76] Error: {
#   message: 'Akses ditolak',
#   code: 3002,
#   stack: 'AppError: Akses ditolak\\n' +
#     '    at sendPermissionError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:252:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2641:20)\\n' +
#     '    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)'
# }
    # Subtest: denies access to other user file
    ok 2 - denies access to other user file
      ---
      duration_ms: 6.9797
      type: 'test'
      ...
# [req_1771479972519_4e7eae0c] Error: {
#   message: 'Nama file tidak valid',
#   code: 2001,
#   stack: 'AppError: Nama file tidak valid\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2631:20)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:44:9\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:31:9\\n' +
#     '    at D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:261:12\\n' +
#     '    at getSecret (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:97:14)\\n' +
#     '    at module.exports [as verify] (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:101:10)\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:21:9)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at Route.dispatch (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:117:3)\\n' +
#     '    at handle (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\index.js:435:11)'
# }
# [req_1771479972522_c0aa6f35] Error: {
#   message: 'Nama file tidak valid',
#   code: 2001,
#   stack: 'AppError: Nama file tidak valid\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2631:20)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:44:9\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:31:9\\n' +
#     '    at D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:261:12\\n' +
#     '    at getSecret (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:97:14)\\n' +
#     '    at module.exports [as verify] (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:101:10)\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:21:9)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at Route.dispatch (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:117:3)\\n' +
#     '    at handle (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\index.js:435:11)'
# }
    # Subtest: blocks path traversal patterns
    ok 3 - blocks path traversal patterns
      ---
      duration_ms: 7.1883
      type: 'test'
      ...
# [req_1771479972528_d69feab5] Error: {
#   message: 'Nama file tidak valid',
#   code: 2001,
#   stack: 'AppError: Nama file tidak valid\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2631:20)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:44:9\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:31:9\\n' +
#     '    at D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:261:12\\n' +
#     '    at getSecret (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:97:14)\\n' +
#     '    at module.exports [as verify] (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\jsonwebtoken\\\\verify.js:101:10)\\n' +
#     '    at authenticateToken (file:///D:/CODING/absenta-13-v3/server/middleware/auth.js:21:9)\\n' +
#     '    at Layer.handleRequest (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\layer.js:152:17)\\n' +
#     '    at next (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:157:13)\\n' +
#     '    at Route.dispatch (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\lib\\\\route.js:117:3)\\n' +
#     '    at handle (D:\\\\CODING\\\\absenta-13-v3\\\\node_modules\\\\router\\\\index.js:435:11)'
# }
    # Subtest: blocks non-xlsx extensions
    ok 4 - blocks non-xlsx extensions
      ---
      duration_ms: 6.6249
      type: 'test'
      ...
# [req_1771479972535_5fa85752] Error: {
#   message: 'Nama file tidak valid',
#   code: 2001,
#   stack: 'AppError: Nama file tidak valid\\n' +
#     '    at sendValidationError (file:///D:/CODING/absenta-13-v3/server/utils/errorHandler.js:228:19)\\n' +
#     '    at downloadFile (file:///D:/CODING/absenta-13-v3/server/controllers/exportController.js:2662:20)'
# }
    # Subtest: blocks symlink escape attempts
    ok 5 - blocks symlink escape attempts
      ---
      duration_ms: 7.3531
      type: 'test'
      ...
    1..5
ok 43 - download routes
  ---
  duration_ms: 434.4652
  type: 'suite'
  ...
1..43
# tests 185
# suites 59
# pass 185
# fail 0
# cancelled 0
# skipped 0
# todo 0
# duration_ms 1089.8514
